<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canada Coin - Plataforma de Gestión de Inversiones</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #3b82f6;
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #1e3a8a;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        
        .drop-zone {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            background-color: #f8fafc;
            cursor: pointer;
        }
        
        .drop-zone.active {
            border-color: var(--primary-color);
            background-color: #eff6ff;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--accent-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .kyc-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .kyc-pending {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .kyc-verified {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .kyc-rejected {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .transaction-item {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-amount.positive {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .transaction-amount.negative {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .stat-card {
            padding: 24px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }
        
        .stat-card.primary::before {
            background-color: var(--primary-color);
        }
        
        .stat-card.success::before {
            background-color: var(--accent-color);
        }
        
        .stat-card.warning::before {
            background-color: var(--warning-color);
        }
        
        .stat-card.info::before {
            background-color: var(--secondary-color);
        }
        
        .nav-item {
            padding: 12px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
        }
        
        .nav-item.active {
            background-color: #eff6ff;
            color: var(--primary-color);
        }
        
        .nav-item:hover:not(.active) {
            background-color: #f9fafb;
            color: #374151;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        #auth-section {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }
        
        #auth-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        
        #auth-section > div {
            position: relative;
            z-index: 2;
        }
        
        .method-details {
            transition: all 0.3s ease;
            max-height: 1000px;
            overflow: hidden;
        }

        .method-details.hidden {
            max-height: 0;
            opacity: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .payment-method {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .payment-method.selected {
            border-color: var(--primary-color);
            background-color: #e6f0ff;
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.2);
        }

        .chart-period-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .chart-tooltip {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        #earnings-projection-container {
            display: none;
        }
        
        #earnings-projection-container.visible {
            display: block;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="notifications-container"></div>
    
    <section id="auth-section" class="min-h-screen flex items-center justify-center p-4">
        <div class="card w-full max-w-md p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Canada Coin</h1>
                <p class="text-gray-600 mt-2">Plataforma de Gestión de Inversiones</p>
            </div>
            
            <div id="login-form">
                <h2 class="text-2xl font-bold mb-6 text-center">Iniciar Sesión</h2>
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="login-email" class="block text-gray-700 mb-2">Correo Electrónico</label>
                        <input type="email" id="login-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-gray-700 mb-2">Contraseña</label>
                        <input type="password" id="login-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="btn-primary w-full mb-4">Iniciar Sesión</button>
                </form>
                <p class="text-center text-gray-600">
                    ¿No tienes una cuenta? 
                    <a href="#" id="show-register" class="text-blue-600 font-medium hover:underline">Regístrate aquí</a>
                </p>
                <div class="mt-4">
                    <p class="text-center text-sm text-gray-500">¿Tienes un código de referido?</p>
                    <input type="text" id="referral-code-input" class="w-full mt-2 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Código de referido (opcional)">
                </div>
            </div>
            
            <div id="register-form" class="hidden">
                <h2 class="text-2xl font-bold mb-6 text-center">Crear Cuenta</h2>
                <form id="registerForm">
                    <div class="mb-4">
                        <label for="register-name" class="block text-gray-700 mb-2">Nombre Completo</label>
                        <input type="text" id="register-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block text-gray-700 mb-2">Correo Electrónico</label>
                        <input type="email" id="register-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-phone" class="block text-gray-700 mb-2">Teléfono</label>
                        <input type="tel" id="register-phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-country" class="block text-gray-700 mb-2">País</label>
                        <select id="register-country" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecciona un país</option>
                            <option value="CA">Canadá</option>
                            <option value="US">Estados Unidos</option>
                            <option value="MX">México</option>
                            <option value="BZ">Belice</option>
                            <option value="CR">Costa Rica</option>
                            <option value="SV">El Salvador</option>
                            <option value="GT">Guatemala</option>
                            <option value="HN">Honduras</option>
                            <option value="NI">Nicaragua</option>
                            <option value="PA">Panamá</option>
                            <option value="AG">Antigua y Barbuda</option>
                            <option value="BS">Bahamas</option>
                            <option value="BB">Barbados</option>
                            <option value="CU">Cuba</option>
                            <option value="DM">Dominica</option>
                            <option value="DO">República Dominicana</option>
                            <option value="GD">Granada</option>
                            <option value="HT">Haití</option>
                            <option value="JM">Jamaica</option>
                            <option value="KN">San Cristóbal y Nieves</option>
                            <option value="LC">Santa Lucía</option>
                            <option value="VC">San Vicente y las Granadinas</option>
                            <option value="TT">Trinidad y Tobago</option>
                            <option value="AR">Argentina</option>
                            <option value="BO">Bolivia</option>
                            <option value="BR">Brasil</option>
                            <option value="CL">Chile</option>
                            <option value="CO">Colombia</option>
                            <option value="EC">Ecuador</option>
                            <option value="GY">Guyana</option>
                            <option value="PY">Paraguay</option>
                            <option value="PE">Perú</option>
                            <option value="SR">Surinam</option>
                            <option value="UY">Uruguay</option>
                            <option value="VE">Venezuela</option>
                            <option value="ES">España</option>
                            <option value="PT">Portugal</option>
                            <option value="FR">Francia</option>
                            <option value="DE">Alemania</option>
                            <option value="IT">Italia</option>
                            <option value="GB">Reino Unido</option>
                            <option value="RU">Rusia</option>
                            <option value="CN">China</option>
                            <option value="JP">Japón</option>
                            <option value="KR">Corea del Sur</option>
                            <option value="IN">India</option>
                            <option value="ZA">Sudáfrica</option>
                            <option value="EG">Egipto</option>
                            <option value="NG">Nigeria</option>
                            <option value="AU">Australia</option>
                            <option value="NZ">Nueva Zelanda</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label for="register-password" class="block text-gray-700 mb-2">Contraseña</label>
                        <input type="password" id="register-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="register-confirm-password" class="block text-gray-700 mb-2">Confirmar Contraseña</label>
                        <input type="password" id="register-confirm-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-referral-code" class="block text-gray-700 mb-2">Código de Referido (opcional)</label>
                        <input type="text" id="register-referral-code" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Si te invitó un amigo, ingresa su código aquí">
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="register-terms" class="mr-2" required>
                            <span class="text-gray-700">Acepto los <a href="#" class="text-blue-600 hover:underline">Términos y Condiciones</a> y la <a href="#" class="text-blue-600 hover:underline">Política de Privacidad</a></span>
                        </label>
                    </div>
                    <button type="submit" class="btn-primary w-full mb-4">Crear Cuenta</button>
                </form>
                <p class="text-center text-gray-600">
                    ¿Ya tienes una cuenta? 
                    <a href="#" id="show-login" class="text-blue-600 font-medium hover:underline">Inicia sesión aquí</a>
                </p>
            </div>
        </div>
    </section>
    
    <section id="dashboard-section" class="hidden">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold text-gray-900">Canada Coin</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="user-menu-button" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                                <span id="user-name" class="font-medium">Usuario</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>
                            <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-10">
                                <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-user mr-2"></i>Mi Perfil</a>
                                <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-cog mr-2"></i>Configuración</a>
                                <a href="#" id="logout-button" class="block px-4 py-2 text-gray-700 hover:bg-gray-100"><i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <div class="lg:w-1/4">
                    <div class="card p-6 mb-6">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-user text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h2 id="dashboard-user-name" class="font-bold text-lg">Usuario</h2>
                                <div class="flex items-center mt-1">
                                    <span id="kyc-status" class="kyc-status kyc-pending">KYC Pendiente</span>
                                </div>
                            </div>
                        </div>
                        
                        <nav class="space-y-2">
                            <a href="#" class="nav-item active" data-section="dashboard">
                                <i class="fas fa-home w-5"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="#" class="nav-item" data-section="performance">
                                <i class="fas fa-chart-line w-5"></i>
                                <span>Rendimientos</span>
                            </a>
                            <a href="#" class="nav-item" data-section="deposits">
                                <i class="fas fa-wallet w-5"></i>
                                <span>Depósitos</span>
                            </a>
                            <a href="#" class="nav-item" data-section="withdrawals">
                                <i class="fas fa-money-bill-wave w-5"></i>
                                <span>Retiros</span>
                            </a>
                            <a href="#" class="nav-item" data-section="referrals">
                                <i class="fas fa-users w-5"></i>
                                <span>Referidos</span>
                            </a>
                            <a href="#" class="nav-item" data-section="settings">
                                <i class="fas fa-cog w-5"></i>
                                <span>Configuración</span>
                            </a>
                            <a href="#" class="nav-item" data-section="kyc-verification">
                                <i class="fas fa-user-check w-5"></i>
                                <span>Verificación KYC</span>
                            </a>
                            <a href="#" class="nav-item" data-section="help">
                                <i class="fas fa-question-circle w-5"></i>
                                <span>Ayuda</span>
                            </a>
                        </nav>
                    </div>
                    
                    <div class="card p-6">
                        <h3 class="font-bold text-lg mb-4">Acciones Rápidas</h3>
                        <div class="space-y-3">
                            <button id="open-deposit-modal" class="btn-primary w-full flex items-center justify-center">
                                <i class="fas fa-plus mr-2"></i> Realizar Depósito
                            </button>
                            <button id="open-withdrawal-modal" class="btn-secondary w-full flex items-center justify-center">
                                <i class="fas fa-download mr-2"></i> Solicitar Retiro
                            </button>
                            <button id="open-referral-modal" class="btn-success w-full flex items-center justify-center">
                                <i class="fas fa-share-alt mr-2"></i> Invitar Amigos
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="lg:w-3/4">
                    <div id="dashboard" class="section active">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card primary card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-600">Saldo Total</p>
                                        <h3 id="total-balance" class="text-2xl font-bold mt-1">$0.00</h3>
                                    </div>
                                    <div class="p-3 bg-blue-100 rounded-lg">
                                        <i class="fas fa-wallet text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                                <p id="performance-percentage" class="text-sm text-gray-500 mt-2">+0% desde el inicio</p>
                            </div>
                            
                            <div class="stat-card success card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-600">Depósitos</p>
                                        <h3 id="total-deposits" class="text-2xl font-bold mt-1">$0.00</h3>
                                    </div>
                                    <div class="p-3 bg-green-100 rounded-lg">
                                        <i class="fas fa-arrow-up text-green-600 text-xl"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500 mt-2">Total invertido</p>
                            </div>
                            
                            <div class="stat-card warning card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-600">Rendimientos</p>
                                        <h3 id="total-earnings" class="text-2xl font-bold mt-1">$0.00</h3>
                                    </div>
                                    <div class="p-3 bg-yellow-100 rounded-lg">
                                        <i class="fas fa-chart-line text-yellow-600 text-xl"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500 mt-2">Ganancias acumuladas (12.5% mensual)</p>
                            </div>
                            
                            <div class="stat-card info card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-600">Referidos</p>
                                        <h3 id="total-referrals" class="text-2xl font-bold mt-1">0</h3>
                                    </div>
                                    <div class="p-3 bg-blue-100 rounded-lg">
                                        <i class="fas fa-users text-blue-600 text-xl"></i>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500 mt-2">+$0 en bonos</p>
                            </div>
                        </div>
                        
                        <div class="card p-6 mb-8">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold">Rendimiento de Inversión</h2>
                                <div class="flex space-x-2">
                                    <button class="chart-period-btn px-3 py-1 text-sm bg-blue-100 text-blue-600 rounded-lg font-medium" data-period="7d">7D</button>
                                    <button class="chart-period-btn px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-blue-100 hover:text-blue-600 transition-colors" data-period="30d">30D</button>
                                    <button class="chart-period-btn px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-blue-100 hover:text-blue-600 transition-colors" data-period="90d">90D</button>
                                    <button class="chart-period-btn px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-blue-100 hover:text-blue-600 transition-colors" data-period="1y">1A</button>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <div class="absolute top-4 left-4 z-10">
                                    <div class="bg-white/90 backdrop-blur-sm p-3 rounded-lg shadow-sm">
                                        <p class="text-xs text-gray-600">Rendimiento Total</p>
                                        <p class="text-lg font-bold text-green-600" id="chart-total-return">+0%</p>
                                    </div>
                                </div>
                                
                                <div class="chart-container">
                                    <canvas id="performance-chart" class="w-full h-full rounded-lg"></canvas>
                                </div>
                                
                                <div class="flex justify-center mt-4 space-x-6">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-600">Depósitos</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-600">Ganancias</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                                        <span class="text-sm text-gray-600">Balance Total</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-100">
                                <div class="text-center">
                                    <p class="text-sm text-gray-500">Rendimiento Diario</p>
                                    <p class="text-lg font-bold text-green-600" id="chart-daily-return">+0.42%</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-500">Tasa Mensual</p>
                                    <p class="text-lg font-bold text-blue-600" id="chart-monthly-rate">12.5%</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-500">Proyección Mensual</p>
                                    <p class="text-lg font-bold text-orange-600" id="chart-monthly-projection">$0.00</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-500">Tiempo Invertido</p>
                                    <p class="text-lg font-bold text-purple-600" id="chart-investment-time">0 días</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold">Transacciones Recientes</h2>
                                <button class="text-blue-600 font-medium hover:underline">Ver todas</button>
                            </div>
                            <div id="transactions-list">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-exchange-alt text-3xl mb-2"></i>
                                    <p>No hay transacciones recientes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="performance" class="section">
                        <div class="card p-6">
                            <h2 class="text-xl font-bold mb-6">Seguimiento de Rendimientos</h2>
                            
                            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <div class="flex items-start">
                                    <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                                    <div>
                                        <p class="font-medium text-blue-800">Tasa de Rendimiento</p>
                                        <p class="text-blue-700 text-sm mt-1">Tu inversión genera un 12.5% mensual (0.4167% diario). Las ganancias se calculan y actualizan automáticamente cada día.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Rendimiento Diario Estimado</h3>
                                    <p class="text-3xl font-bold" id="daily-earnings">$0.00</p>
                                    <p class="mt-2">Basado en tu capital actual (0.4167% diario)</p>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Rendimiento Total</h3>
                                    <p class="text-3xl font-bold" id="performance-total">+0%</p>
                                    <p class="mt-2">Desde el inicio de tu inversión</p>
                                </div>
                                
                                <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Ganancias Acumuladas</h3>
                                    <p class="text-3xl font-bold" id="performance-earnings">$0.00</p>
                                    <p class="mt-2">Total de rendimientos generados</p>
                                </div>
                                
                                <div class="bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Capital Invertido</h3>
                                    <p class="text-3xl font-bold" id="performance-capital">$0.00</p>
                                    <p class="mt-2">Total de depósitos realizados</p>
                                </div>
                            </div>
                            
                            <div id="earnings-projection-container" class="bg-gray-50 p-6 rounded-lg mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold">Proyección de Crecimiento (Próximos 30 días)</h3>
                                    <button id="toggle-projection" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-eye"></i> Mostrar/Ocultar
                                    </button>
                                </div>
                                <div id="earnings-projection" class="overflow-x-auto">
                                    <div class="text-center py-4 text-gray-500">
                                        <p>Realiza un depósito para ver la proyección de ganancias</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h3 class="text-lg font-bold mb-4">Cálculo Detallado de Rendimientos</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <p class="text-sm text-gray-600">Tasa Mensual</p>
                                        <p class="text-2xl font-bold text-green-600">12.5%</p>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <p class="text-sm text-gray-600">Tasa Diaria</p>
                                        <p class="text-2xl font-bold text-blue-600">0.4167%</p>
                                    </div>
                                    <div class="text-center p-4 bg-white rounded-lg">
                                        <p class="text-sm text-gray-600">Tasa Anual</p>
                                        <p class="text-2xl font-bold text-purple-600">150%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="deposits" class="section">
                        <div class="card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold">Historial de Depósitos</h2>
                                <button id="open-deposit-modal-from-section" class="btn-primary flex items-center">
                                    <i class="fas fa-plus mr-2"></i> Nuevo Depósito
                                </button>
                            </div>
                            <div id="deposits-list">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-wallet text-3xl mb-2"></i>
                                    <p>No hay depósitos registrados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="withdrawals" class="section">
                        <div class="card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold">Solicitudes de Retiro</h2>
                                <button id="open-withdrawal-modal-from-section" class="btn-secondary flex items-center">
                                    <i class="fas fa-download mr-2"></i> Solicitar Retiro
                                </button>
                            </div>
                            <div id="withdrawals-list">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-money-bill-wave text-3xl mb-2"></i>
                                    <p>No hay retiros registrados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="referrals" class="section">
                        <div class="card p-6">
                            <h2 class="text-xl font-bold mb-6">Programa de Referidos</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Tu Código de Referido</h3>
                                    <div class="flex items-center mt-4">
                                        <code id="referral-code" class="bg-white text-purple-600 px-4 py-2 rounded-lg text-lg font-bold mr-4">CARGANDO...</code>
                                        <button id="copy-referral-code" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-medium hover:bg-gray-100">
                                            <i class="fas fa-copy mr-2"></i> Copiar
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-xl">
                                    <h3 class="text-lg font-bold mb-2">Tus Referidos</h3>
                                    <p class="text-3xl font-bold" id="referrals-count">0</p>
                                    <p class="mt-2">Personas que se han unido con tu código</p>
                                </div>
                            </div>
                            
                            <div class="mb-6 p-6 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl">
                                <h3 class="text-lg font-bold mb-4">Activar Código de Referido</h3>
                                <p class="mb-4">¿Tienes un código de referido? ¡Actívalo para recibir tu bono de bienvenida de $25!</p>
                                <div class="flex">
                                    <input type="text" id="activate-referral-input" class="flex-1 px-4 py-2 rounded-l-lg text-gray-800" placeholder="Ingresa el código de referido">
                                    <button id="activate-referral-button" class="bg-white text-blue-600 px-4 py-2 rounded-r-lg font-medium hover:bg-gray-100">
                                        <i class="fas fa-check mr-2"></i> Activar
                                    </button>
                                </div>
                                <p class="text-sm mt-2 opacity-90">* El bono se acredita después de tu primer depósito mínimo de $100</p>
                            </div>
                            
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h3 class="text-lg font-bold mb-4">Tus Bonos por Referidos</h3>
                                <div id="referrals-bonus-list">
                                    <div class="text-center py-8 text-gray-500">
                                        <i class="fas fa-users text-3xl mb-2"></i>
                                        <p>No has recibido bonos por referidos aún</p>
                                        <p class="text-sm mt-2">Comparte tu código para empezar a ganar</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="settings" class="section">
                        <div class="card p-6">
                            <h2 class="text-xl font-bold mb-6">Configuración de Cuenta</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-bold mb-4">Información Personal</h3>
                                    <form id="profile-form">
                                        <div class="mb-4">
                                            <label for="profile-name" class="block text-gray-700 mb-2">Nombre Completo</label>
                                            <input type="text" id="profile-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="profile-email" class="block text-gray-700 mb-2">Correo Electrónico</label>
                                            <input type="email" id="profile-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="profile-phone" class="block text-gray-700 mb-2">Teléfono</label>
                                            <input type="tel" id="profile-phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div class="mb-4">
                                            <label for="profile-country" class="block text-gray-700 mb-2">País</label>
                                            <select id="profile-country" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="">Selecciona un país</option>
												<option value="CA">Canadá</option>
												<option value="US">Estados Unidos</option>
												<option value="MX">México</option>
												<option value="BZ">Belice</option>
												<option value="CR">Costa Rica</option>
												<option value="SV">El Salvador</option>
												<option value="GT">Guatemala</option>
												<option value="HN">Honduras</option>
												<option value="NI">Nicaragua</option>
												<option value="PA">Panamá</option>
												<option value="AG">Antigua y Barbuda</option>
												<option value="BS">Bahamas</option>
												<option value="BB">Barbados</option>
												<option value="CU">Cuba</option>
												<option value="DM">Dominica</option>
												<option value="DO">República Dominicana</option>
												<option value="GD">Granada</option>
												<option value="HT">Haití</option>
												<option value="JM">Jamaica</option>
												<option value="KN">San Cristóbal y Nieves</option>
												<option value="LC">Santa Lucía</option>
												<option value="VC">San Vicente y las Granadinas</option>
												<option value="TT">Trinidad y Tobago</option>
												<option value="AR">Argentina</option>
												<option value="BO">Bolivia</option>
												<option value="BR">Brasil</option>
												<option value="CL">Chile</option>
												<option value="CO">Colombia</option>
												<option value="EC">Ecuador</option>
												<option value="GY">Guyana</option>
												<option value="PY">Paraguay</option>
												<option value="PE">Perú</option>
												<option value="SR">Surinam</option>
												<option value="UY">Uruguay</option>
												<option value="VE">Venezuela</option>
												<option value="ES">España</option>
												<option value="PT">Portugal</option>
												<option value="FR">Francia</option>
												<option value="DE">Alemania</option>
												<option value="IT">Italia</option>
												<option value="GB">Reino Unido</option>
												<option value="RU">Rusia</option>
												<option value="CN">China</option>
												<option value="JP">Japón</option>
												<option value="KR">Corea del Sur</option>
												<option value="IN">India</option>
												<option value="ZA">Sudáfrica</option>
												<option value="EG">Egipto</option>
												<option value="NG">Nigeria</option>
												<option value="AU">Australia</option>
												<option value="NZ">Nueva Zelanda</option>
                                            </select>
                                        </div>
                                        <div class="mb-4">
                                            <label for="profile-document-type" class="block text-gray-700 mb-2">Tipo de Documento</label>
                                            <select id="profile-document-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="">Selecciona tipo</option>
                                                <option value="dni">DNI</option>
                                                <option value="passport">Pasaporte</option>
                                                <option value="driver_license">Licencia de Conducir</option>
                                                <option value="id_card">Cédula de Identidad</option>
                                                <option value="tax_id">Número de Identificación Fiscal</option>
                                                <option value="social_security">Seguridad Social</option>
                                                <option value="residence_card">Tarjeta de Residencia</option>
                                            </select>
                                        </div>
                                        <div class="mb-4">
                                            <label for="profile-document-number" class="block text-gray-700 mb-2">Número de Documento</label>
                                            <input type="text" id="profile-document-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: 12345678">
                                        </div>
                                        <button type="submit" class="btn-primary">Guardar Cambios</button>
                                    </form>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold mb-4">Seguridad</h3>
                                    <div class="mb-6">
                                        <label for="current-password" class="block text-gray-700 mb-2">Contraseña Actual</label>
                                        <input type="password" id="current-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="mb-4">
                                        <label for="new-password" class="block text-gray-700 mb-2">Nueva Contraseña</label>
                                        <input type="password" id="new-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="mb-6">
                                        <label for="confirm-new-password" class="block text-gray-700 mb-2">Confirmar Nueva Contraseña</label>
                                        <input type="password" id="confirm-new-password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <button id="change-password" class="btn-secondary">Cambiar Contraseña</button>
                                    
                                    <div class="mt-8 pt-6 border-t border-gray-200">
                                        <h3 class="text-lg font-bold mb-4">Configuración de Retiros Internacionales</h3>
                                        <div class="mb-4">
                                            <label for="international-bank-name" class="block text-gray-700 mb-2">Nombre del Banco Internacional</label>
                                            <input type="text" id="international-bank-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: HSBC, Citibank, etc.">
                                        </div>
                                        <div class="mb-4">
                                            <label for="swift-code" class="block text-gray-700 mb-2">Código SWIFT/BIC</label>
                                            <input type="text" id="swift-code" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: HSBCUS33">
                                        </div>
                                        <div class="mb-4">
                                            <label for="iban-number" class="block text-gray-700 mb-2">Número IBAN (Europa)</label>
                                            <input type="text" id="iban-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: GB29NWBK60161331926819">
                                        </div>
                                        <button id="save-international-settings" class="btn-primary">Guardar Configuración</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="kyc-verification" class="section">
                        <div class="card p-6">
                            <h2 class="text-xl font-bold mb-6">Verificación de Identidad (KYC)</h2>
                            
                            <div class="mb-6">
                                <div class="flex items-center mb-4">
                                    <div id="kyc-status-badge" class="kyc-status kyc-pending">KYC Pendiente</div>
                                    <button id="refresh-kyc-status" class="ml-4 text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                
                                <div id="kyc-instructions" class="p-4 bg-blue-50 border border-blue-200 rounded-lg mb-6">
                                    <h3 class="font-bold text-blue-800 mb-2">Instrucciones para la Verificación KYC</h3>
                                    <p class="text-blue-700 mb-2">Para completar tu verificación de identidad, necesitamos que subas los siguientes documentos:</p>
                                    <ol class="list-decimal list-inside text-blue-700 space-y-1">
                                        <li>Documento de identificación oficial (DNI, Pasaporte o Licencia)</li>
                                        <li>Selfie sosteniendo tu documento de identificación</li>
                                        <li>Comprobante de domicilio reciente (menos de 3 meses)</li>
                                    </ol>
                                    <p class="text-blue-700 mt-2">Una vez enviados, nuestro equipo verificará tus documentos en 24-48 horas.</p>
                                </div>
                            </div>
                            
                            <form id="kyc-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label for="kyc-full-name" class="block text-gray-700 mb-2">Nombre Completo (como aparece en el documento)</label>
                                        <input type="text" id="kyc-full-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    <div>
                                        <label for="kyc-birthdate" class="block text-gray-700 mb-2">Fecha de Nacimiento</label>
                                        <input type="date" id="kyc-birthdate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    <div>
                                        <label for="kyc-id-type" class="block text-gray-700 mb-2">Tipo de Documento</label>
                                        <select id="kyc-id-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                            <option value="">Seleccionar</option>
                                            <option value="dni">DNI</option>
                                            <option value="passport">Pasaporte</option>
                                            <option value="driver_license">Licencia de Conducir</option>
                                            <option value="id_card">Cédula de Identidad</option>
                                            <option value="tax_id">Número de Identificación Fiscal</option>
                                            <option value="social_security">Seguridad Social</option>
                                            <option value="residence_card">Tarjeta de Residencia</option>
                                            <option value="other">Otro</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="kyc-id-number" class="block text-gray-700 mb-2">Número de Documento</label>
                                        <input type="text" id="kyc-id-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    </div>
                                    
                                    <div>
                                        <label for="kyc-id-country" class="block text-gray-700 mb-2">País Emisor</label>
                                        <select id="kyc-id-country" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                            <option value="">Seleccionar país</option>
											<option value="CA">Canadá</option>
											<option value="US">Estados Unidos</option>
											<option value="MX">México</option>
											<option value="BZ">Belice</option>
											<option value="CR">Costa Rica</option>
											<option value="SV">El Salvador</option>
											<option value="GT">Guatemala</option>
											<option value="HN">Honduras</option>
											<option value="NI">Nicaragua</option>
											<option value="PA">Panamá</option>
											<option value="AG">Antigua y Barbuda</option>
											<option value="BS">Bahamas</option>
											<option value="BB">Barbados</option>
											<option value="CU">Cuba</option>
											<option value="DM">Dominica</option>
											<option value="DO">República Dominicana</option>
											<option value="GD">Granada</option>
											<option value="HT">Haití</option>
											<option value="JM">Jamaica</option>
											<option value="KN">San Cristóbal y Nieves</option>
											<option value="LC">Santa Lucía</option>
											<option value="VC">San Vicente y las Granadinas</option>
											<option value="TT">Trinidad y Tobago</option>
											<option value="AR">Argentina</option>
											<option value="BO">Bolivia</option>
											<option value="BR">Brasil</option>
											<option value="CL">Chile</option>
											<option value="CO">Colombia</option>
											<option value="EC">Ecuador</option>
											<option value="GY">Guyana</option>
											<option value="PY">Paraguay</option>
											<option value="PE">Perú</option>
											<option value="SR">Surinam</option>
											<option value="UY">Uruguay</option>
											<option value="VE">Venezuela</option>
											<option value="ES">España</option>
											<option value="PT">Portugal</option>
											<option value="FR">Francia</option>
											<option value="DE">Alemania</option>
											<option value="IT">Italia</option>
											<option value="GB">Reino Unido</option>
											<option value="RU">Rusia</option>
											<option value="CN">China</option>
											<option value="JP">Japón</option>
											<option value="KR">Corea del Sur</option>
											<option value="IN">India</option>
											<option value="ZA">Sudáfrica</option>
											<option value="EG">Egipto</option>
											<option value="NG">Nigeria</option>
											<option value="AU">Australia</option>
											<option value="NZ">Nueva Zelanda</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="kyc-address" class="block text-gray-700 mb-2">Dirección Completa</label>
                                        <textarea id="kyc-address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
                                    </div>
                                </div>
                                
                                <div class="space-y-6">
                                    <div class="border border-gray-300 rounded-lg p-4">
                                        <h3 class="font-bold text-lg mb-4">1. Documento de Identificación (Frente) *</h3>
                                        <div class="kyc-drop-zone drop-zone" data-doc-type="id_front">
                                            <i class="fas fa-id-card text-3xl text-gray-400 mb-2"></i>
                                            <p class="text-gray-600">Arrastra la imagen del frente de tu documento aquí</p>
                                            <p class="text-sm text-gray-500 mt-1">Formatos: JPG, PNG, PDF (Máx. 5 MB)</p>
                                            <input type="file" class="hidden kyc-file-input" accept=".jpg,.jpeg,.png,.pdf" data-doc-type="id_front">
                                        </div>
                                        <div class="kyc-file-preview hidden mt-4" data-doc-type="id_front"></div>
                                    </div>
                                    
                                    <div class="border border-gray-300 rounded-lg p-4">
                                        <h3 class="font-bold text-lg mb-4">2. Documento de Identificación (Reverso) *</h3>
                                        <div class="kyc-drop-zone drop-zone" data-doc-type="id_back">
                                            <i class="fas fa-id-card text-3xl text-gray-400 mb-2"></i>
                                            <p class="text-gray-600">Arrastra la imagen del reverso de tu documento aquí</p>
                                            <p class="text-sm text-gray-500 mt-1">Formatos: JPG, PNG, PDF (Máx. 5 MB)</p>
                                            <input type="file" class="hidden kyc-file-input" accept=".jpg,.jpeg,.png,.pdf" data-doc-type="id_back">
                                        </div>
                                        <div class="kyc-file-preview hidden mt-4" data-doc-type="id_back"></div>
                                    </div>
                                    
                                    <div class="border border-gray-300 rounded-lg p-4">
                                        <h3 class="font-bold text-lg mb-4">3. Selfie con Documento *</h3>
                                        <div class="kyc-drop-zone drop-zone" data-doc-type="selfie">
                                            <i class="fas fa-user text-3xl text-gray-400 mb-2"></i>
                                            <p class="text-gray-600">Arrastra una selfie sosteniendo tu documento</p>
                                            <p class="text-sm text-gray-500 mt-1">Formatos: JPG, PNG (Máx. 5 MB)</p>
                                            <input type="file" class="hidden kyc-file-input" accept=".jpg,.jpeg,.png" data-doc-type="selfie">
                                        </div>
                                        <div class="kyc-file-preview hidden mt-4" data-doc-type="selfie"></div>
                                    </div>
                                    
                                    <div class="border border-gray-300 rounded-lg p-4">
                                        <h3 class="font-bold text-lg mb-4">4. Comprobante de Domicilio (Opcional)</h3>
                                        <div class="kyc-drop-zone drop-zone" data-doc-type="proof_of_address">
                                            <i class="fas fa-home text-3xl text-gray-400 mb-2"></i>
                                            <p class="text-gray-600">Arrastra tu comprobante de domicilio</p>
                                            <p class="text-sm text-gray-500 mt-1">Formatos: JPG, PNG, PDF (Máx. 5 MB)</p>
                                            <input type="file" class="hidden kyc-file-input" accept=".jpg,.jpeg,.png,.pdf" data-doc-type="proof_of_address">
                                        </div>
                                        <div class="kyc-file-preview hidden mt-4" data-doc-type="proof_of_address"></div>
                                    </div>
                                </div>
                                
                                <div class="flex justify-end">
                                    <button type="submit" id="submit-kyc" class="btn-primary flex items-center">
                                        <i class="fas fa-paper-plane mr-2"></i> Enviar para Verificación
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="help" class="section">
                        <div class="card p-6">
                            <h2 class="text-xl font-bold mb-6">Centro de Ayuda</h2>
                            <div class="space-y-4">
                                <div class="border border-gray-200 rounded-lg">
                                    <button class="faq-question w-full text-left p-4 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                                        ¿Cómo realizar un depósito?
                                    </button>
                                    <div class="faq-answer p-4 hidden">
                                        <p>Para realizar un depósito, sigue estos pasos:</p>
                                        <ol class="list-decimal list-inside mt-2 space-y-1">
                                            <li>Haz clic en "Realizar Depósito" en el panel principal</li>
                                            <li>Selecciona el monto y método de pago</li>
                                            <li>Sube el comprobante de pago</li>
                                            <li>Confirma el depósito</li>
                                        </ol>
                                    </div>
                                </div>
                                <div class="border border-gray-200 rounded-lg">
                                    <button class="faq-question w-full text-left p-4 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                                        ¿Cuánto tiempo tarda en procesarse un retiro?
                                    </button>
                                    <div class="faq-answer p-4 hidden">
                                        <p>Los retiros generalmente se procesan en 3-5 días hábiles. El tiempo exacto puede variar dependiendo del método de retiro seleccionado y de la verificación de seguridad.</p>
                                    </div>
                                </div>
                                <div class="border border-gray-200 rounded-lg">
                                    <button class="faq-question w-full text-left p-4 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                                        ¿Cómo funciona el programa de referidos?
                                    </button>
                                    <div class="faq-answer p-4 hidden">
                                        <p>Al compartir tu código único de referido, recibirás $25 por cada persona que se registre y realice su primer depósito. Tus referidos también recibirán un bono de bienvenida.</p>
                                    </div>
                                </div>
                                <div class="border border-gray-200 rounded-lg">
                                    <button class="faq-question w-full text-left p-4 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-lg">
                                        ¿Cómo se calculan los rendimientos?
                                    </button>
                                    <div class="faq-answer p-4 hidden">
                                        <p>Los rendimientos se calculan automáticamente con una tasa del 12.5% mensual (0.4167% diario). Las ganancias se acumulan diariamente y se actualizan automáticamente en tu cuenta.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Realizar Depósito</h2>
                    <button id="close-deposit-modal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <form id="deposit-form" novalidate>
                    <div class="mb-6">
                        <label for="deposit-amount" class="block text-gray-700 mb-2">Monto a Depositar (USD)</label>
                        <input type="number" id="deposit-amount" min="100" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0.00" required>
                        <p class="text-xs text-gray-500 mt-1">Monto mínimo: $100 USD</p>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Método de Pago</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="payment-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
                                <input type="radio" id="method-bank" name="payment-method" value="bank" class="hidden" checked>
                                <label for="method-bank" class="cursor-pointer">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fas fa-university text-blue-600 text-xl"></i>
                                    </div>
                                    <p class="font-medium">Transferencia Bancaria</p>
                                </label>
                            </div>
                            <div class="payment-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
                                <input type="radio" id="method-paypal" name="payment-method" value="paypal" class="hidden">
                                <label for="method-paypal" class="cursor-pointer">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fab fa-paypal text-blue-600 text-xl"></i>
                                    </div>
                                    <p class="font-medium">PayPal</p>
                                </label>
                            </div>
                            <div class="payment-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
                                <input type="radio" id="method-crypto" name="payment-method" value="crypto" class="hidden">
                                <label for="method-crypto" class="cursor-pointer">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fas fa-coins text-blue-600 text-xl"></i>
                                    </div>
                                    <p class="font-medium">Criptomonedas</p>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="payment-details" class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-bold mb-2">Instrucciones para Transferencia Bancaria</h3>
                        <p class="text-gray-600 mb-2">Realiza una transferencia a la siguiente cuenta:</p>
                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p><strong>Banco:</strong> Canada Coin Financial</p>
                            <p><strong>Cuenta:</strong> 1234567890</p>
                            <p><strong>SWIFT/BIC:</strong> CCFIUS33</p>
                            <p><strong>Beneficiario:</strong> Canada Coin Investments LLC</p>
                            <p><strong>Referencia:</strong> Tu correo electrónico o ID de usuario</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Una vez realizada la transferencia, sube el comprobante a continuación.</p>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2">Comprobante de Pago</label>
                        <div id="drop-zone" class="drop-zone">
                            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Arrastra tu archivo aquí o haz clic para seleccionar</p>
                            <p class="text-sm text-gray-500 mt-1">Formatos permitidos: PDF, JPG, PNG (Máx. 5 MB)</p>
                            <input type="file" id="file-input" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <div id="file-preview" class="hidden mt-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <i class="fas fa-file text-blue-600 text-xl mr-3"></i>
                                    <div>
                                        <p id="file-name" class="font-medium"></p>
                                        <p id="file-size" class="text-sm text-gray-500"></p>
                                    </div>
                                </div>
                                <button id="remove-file" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                            <div>
                                <p class="font-medium text-blue-800">Tiempo de Procesamiento</p>
                                <p class="text-blue-700 text-sm mt-1">Los depósitos son verificados manualmente por nuestro equipo y generalmente se procesan en 24-48 horas hábiles. Recibirás una notificación por correo electrónico una vez aprobado.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancel-deposit" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancelar</button>
                        <button type="submit" id="submit-deposit" class="btn-primary flex items-center">
                            <span>Confirmar Depósito</span>
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

	<div id="withdrawal-modal" class="modal">
		<div class="modal-content">
			<div class="p-6 border-b border-gray-200">
				<div class="flex justify-between items-center">
					<h2 class="text-xl font-bold">Solicitar Retiro</h2>
					<button id="close-withdrawal-modal" class="text-gray-400 hover:text-gray-600">
						<i class="fas fa-times text-xl"></i>
					</button>
				</div>
			</div>

			<div class="p-6">
				<form id="withdrawal-form" novalidate>
					<div class="mb-6">
						<label for="withdrawal-amount" class="block text-gray-700 mb-2">Monto a Retirar (USD)</label>
						<input type="number" id="withdrawal-amount" min="10" step="0.01"
							   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
							   placeholder="0.00" required>
						<p class="text-sm text-gray-500 mt-1">Saldo disponible: <span id="available-balance">$0.00</span></p>
					</div>

					<div class="mb-6">
						<label class="block text-gray-700 mb-2">Método de Retiro</label>
						<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
							<div class="payment-method withdrawal-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
								<input type="radio" id="withdrawal-bank" name="withdrawal-method" value="bank" class="hidden" checked>
								<label for="withdrawal-bank" class="cursor-pointer">
									<div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
										<i class="fas fa-university text-blue-600 text-xl"></i>
									</div>
									<p class="font-medium">Banco Local</p>
								</label>
							</div>

							<div class="payment-method withdrawal-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
								<input type="radio" id="withdrawal-paypal" name="withdrawal-method" value="paypal" class="hidden">
								<label for="withdrawal-paypal" class="cursor-pointer">
									<div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
										<i class="fab fa-paypal text-blue-600 text-xl"></i>
									</div>
									<p class="font-medium">PayPal</p>
								</label>
							</div>

							<div class="payment-method withdrawal-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
								<input type="radio" id="withdrawal-crypto" name="withdrawal-method" value="crypto" class="hidden">
								<label for="withdrawal-crypto" class="cursor-pointer">
									<div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
										<i class="fas fa-coins text-blue-600 text-xl"></i>
									</div>
									<p class="font-medium">Cripto</p>
								</label>
							</div>

							<div class="payment-method withdrawal-method border border-gray-300 rounded-lg p-4 text-center cursor-pointer transition-all hover:border-blue-500">
								<input type="radio" id="withdrawal-international" name="withdrawal-method" value="international" class="hidden">
								<label for="withdrawal-international" class="cursor-pointer">
									<div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
										<i class="fas fa-globe text-blue-600 text-xl"></i>
									</div>
									<p class="font-medium">Banco Internacional</p>
								</label>
							</div>
						</div>
					</div>

					<div id="withdrawal-details" class="mb-6">
						<div id="bank-details" class="method-details">
							<h3 class="font-bold mb-4 text-gray-800">Información Bancaria Local</h3>

							<div class="mb-4">
								<label for="bank-name" class="block text-gray-700 mb-2">Nombre del Banco *</label>
								<input type="text" id="bank-name"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="Ej: Banco Nacional" required>
							</div>

							<div class="mb-4">
								<label for="account-number" class="block text-gray-700 mb-2">Número de Cuenta *</label>
								<input type="text" id="account-number"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="Ej: 1234567890" required>
							</div>

							<div class="mb-4">
								<label for="account-holder" class="block text-gray-700 mb-2">Nombre del Titular *</label>
								<input type="text" id="account-holder"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="Nombre completo como aparece en el banco" required>
							</div>

							<div class="mb-4">
								<label for="account-type" class="block text-gray-700 mb-2">Tipo de Cuenta *</label>
								<select id="account-type"
										class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
										required>
									<option value="">Seleccionar tipo</option>
									<option value="checking">Cuenta Corriente</option>
									<option value="savings">Cuenta de Ahorros</option>
									<option value="business">Cuenta Empresarial</option>
								</select>
							</div>
						</div>

						<div id="paypal-details" class="method-details hidden">
							<h3 class="font-bold mb-4 text-gray-800">Información de PayPal</h3>
							<div class="mb-4">
								<label for="paypal-email" class="block text-gray-700 mb-2">Correo Electrónico de PayPal *</label>
								<input type="email" id="paypal-email"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="tucorreo@paypal.com" required>
							</div>
						</div>

						<div id="crypto-details" class="method-details hidden">
							<h3 class="font-bold mb-4 text-gray-800">Información de Criptomonedas</h3>

							<div class="mb-4">
								<label for="crypto-wallet" class="block text-gray-700 mb-2">Dirección de la Billetera *</label>
								<input type="text" id="crypto-wallet"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="Ej: 0x742d35Cc6634C0532925a3b8D4C9db7c1b7c8e8e" required>
							</div>

							<div class="mb-4">
								<label for="crypto-network" class="block text-gray-700 mb-2">Red / Network *</label>
								<input type="text" id="crypto-network"
									   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
									   placeholder="Ej: ERC20, TRC20, BEP20" required>
							</div>
						</div>

						<div id="international-details" class="method-details hidden">
							<h3 class="font-bold mb-4 text-gray-800">Información Bancaria Internacional</h3>
							
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
								<div>
									<label for="international-bank-country" class="block text-gray-700 mb-2">País del Banco *</label>
									<select id="international-bank-country" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
										<option value="">Selecciona un país</option>
										<option value="CA">Canadá</option>
										<option value="US">Estados Unidos</option>
										<option value="MX">México</option>
										<option value="BZ">Belice</option>
										<option value="CR">Costa Rica</option>
										<option value="SV">El Salvador</option>
										<option value="GT">Guatemala</option>
										<option value="HN">Honduras</option>
										<option value="NI">Nicaragua</option>
										<option value="PA">Panamá</option>
										<option value="AG">Antigua y Barbuda</option>
										<option value="BS">Bahamas</option>
										<option value="BB">Barbados</option>
										<option value="CU">Cuba</option>
										<option value="DM">Dominica</option>
										<option value="DO">República Dominicana</option>
										<option value="GD">Granada</option>
										<option value="HT">Haití</option>
										<option value="JM">Jamaica</option>
										<option value="KN">San Cristóbal y Nieves</option>
										<option value="LC">Santa Lucía</option>
										<option value="VC">San Vicente y las Granadinas</option>
										<option value="TT">Trinidad y Tobago</option>
										<option value="AR">Argentina</option>
										<option value="BO">Bolivia</option>
										<option value="BR">Brasil</option>
										<option value="CL">Chile</option>
										<option value="CO">Colombia</option>
										<option value="EC">Ecuador</option>
										<option value="GY">Guyana</option>
										<option value="PY">Paraguay</option>
										<option value="PE">Perú</option>
										<option value="SR">Surinam</option>
										<option value="UY">Uruguay</option>
										<option value="VE">Venezuela</option>
										<option value="ES">España</option>
										<option value="PT">Portugal</option>
										<option value="FR">Francia</option>
										<option value="DE">Alemania</option>
										<option value="IT">Italia</option>
										<option value="GB">Reino Unido</option>
										<option value="RU">Rusia</option>
										<option value="CN">China</option>
										<option value="JP">Japón</option>
										<option value="KR">Corea del Sur</option>
										<option value="IN">India</option>
										<option value="ZA">Sudáfrica</option>
										<option value="EG">Egipto</option>
										<option value="NG">Nigeria</option>
										<option value="AU">Australia</option>
										<option value="NZ">Nueva Zelanda</option>
									</select>
								</div>
								<div>
									<label for="international-bank-name" class="block text-gray-700 mb-2">Nombre del Banco *</label>
									<input type="text" id="international-bank-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: Banco Nacional" required>
								</div>
							</div>
							
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
								<div>
									<label for="international-account-type" class="block text-gray-700 mb-2">Tipo de Cuenta *</label>
									<select id="international-account-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
										<option value="savings">Cuenta de Ahorros</option>
										<option value="checking">Cuenta Corriente</option>
										<option value="business">Cuenta Empresarial</option>
									</select>
								</div>
								<div>
									<label for="international-currency" class="block text-gray-700 mb-2">Moneda de la Cuenta *</label>
									<select id="international-currency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
										<option value="USD">Dólar Americano (USD)</option>
										<option value="CAD">Dólar Canadiense (CAD)</option>
										<option value="MXN">Peso Mexicano (MXN)</option>
										<option value="BZD">Dólar Beliceño (BZD)</option>
										<option value="CRC">Colón Costarricense (CRC)</option>
										<option value="USD">Dólar Americano (USD) - El Salvador</option>
										<option value="GTQ">Quetzal Guatemalteco (GTQ)</option>
										<option value="HNL">Lempira Hondureña (HNL)</option>
										<option value="NIO">Córdoba Nicaragüense (NIO)</option>
										<option value="PAB">Balboa Panameño (PAB)</option>
										<option value="USD">Dólar Americano (USD) - Panamá</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - Antigua y Barbuda</option>
										<option value="BSD">Dólar Bahameño (BSD)</option>
										<option value="BBD">Dólar Barbadense (BBD)</option>
										<option value="CUP">Peso Cubano (CUP)</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - Dominica</option>
										<option value="DOP">Peso Dominicano (DOP)</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - Granada</option>
										<option value="HTG">Gourde Haitiano (HTG)</option>
										<option value="JMD">Dólar Jamaiquino (JMD)</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - San Cristóbal y Nieves</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - Santa Lucía</option>
										<option value="XCD">Dólar del Caribe Oriental (XCD) - San Vicente</option>
										<option value="TTD">Dólar de Trinidad y Tobago (TTD)</option>
										<option value="ARS">Peso Argentino (ARS)</option>
										<option value="BOB">Boliviano (BOB)</option>
										<option value="BRL">Real Brasileño (BRL)</option>
										<option value="CLP">Peso Chileno (CLP)</option>
										<option value="COP">Peso Colombiano (COP)</option>
										<option value="USD">Dólar Americano (USD) - Ecuador</option>
										<option value="GYD">Dólar Guyanés (GYD)</option>
										<option value="PYG">Guaraní Paraguayo (PYG)</option>
										<option value="PEN">Sol Peruano (PEN)</option>
										<option value="SRD">Dólar Surinamés (SRD)</option>
										<option value="UYU">Peso Uruguayo (UYU)</option>
										<option value="VES">Bolívar Soberano (VES)</option>
										<option value="EUR">Euro (EUR) - España</option>
										<option value="EUR">Euro (EUR) - Portugal</option>
										<option value="EUR">Euro (EUR) - Francia</option>
										<option value="EUR">Euro (EUR) - Alemania</option>
										<option value="EUR">Euro (EUR) - Italia</option>
										<option value="GBP">Libra Esterlina (GBP)</option>
										<option value="RUB">Rublo Ruso (RUB)</option>
										<option value="CNY">Yuan Chino (CNY)</option>
										<option value="JPY">Yen Japonés (JPY)</option>
										<option value="KRW">Won Surcoreano (KRW)</option>
										<option value="INR">Rupia India (INR)</option>
										<option value="ZAR">Rand Sudafricano (ZAR)</option>
										<option value="EGP">Libra Egipcia (EGP)</option>
										<option value="NGN">Naira Nigeriana (NGN)</option>
										<option value="AUD">Dólar Australiano (AUD)</option>
										<option value="NZD">Dólar Neozelandés (NZD)</option>
									</select>
								</div>
							</div>
							
							<div class="mb-4">
								<label for="international-account-number" class="block text-gray-700 mb-2">Número de Cuenta *</label>
								<input type="text" id="international-account-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: 1234567890" required>
								<p class="text-xs text-gray-500 mt-1">Ingresa solo números, sin guiones ni espacios</p>
							</div>
							
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
								<div>
									<label for="international-routing-number" class="block text-gray-700 mb-2">Número de Ruta/ABA *</label>
									<input type="text" id="international-routing-number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: 021000021" required>
								</div>
								<div>
									<label for="international-swift-code" class="block text-gray-700 mb-2">Código SWIFT/BIC</label>
									<input type="text" id="international-swift-code" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: BOFAUS3N">
									<p class="text-xs text-gray-500 mt-1">Requerido para transferencias internacionales</p>
								</div>
							</div>
							
							<div class="mb-4">
								<label for="international-account-holder" class="block text-gray-700 mb-2">Nombre del Titular *</label>
								<input type="text" id="international-account-holder" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nombre completo como aparece en el banco" required>
							</div>
							
							<div class="mb-4">
								<label for="international-bank-address" class="block text-gray-700 mb-2">Dirección del Banco</label>
								<textarea id="international-bank-address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Dirección completa del banco (opcional)"></textarea>
							</div>
							
							<div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
								<div class="flex items-start">
									<i class="fas fa-info-circle text-yellow-500 mt-1 mr-3"></i>
									<div>
										<p class="font-medium text-yellow-800">Información Importante</p>
										<p class="text-yellow-700 text-sm mt-1">Las transferencias internacionales pueden tener un tiempo de procesamiento de 3-5 días hábiles. Asegúrate de que toda la información bancaria sea correcta para evitar retrasos.</p>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
						<div class="flex items-start">
							<i class="fas fa-exclamation-triangle text-yellow-500 mt-1 mr-3"></i>
							<div>
								<p class="font-medium text-yellow-800">Tiempo de Procesamiento</p>
								<p class="text-yellow-700 text-sm mt-1">
									Le notificaremos por correo electrónico una vez que su solicitud haya sido aprobada. En ese momento, los fondos serán transferidos a su cuenta.
								</p>
							</div>
						</div>
					</div>

					<div class="flex justify-end space-x-4">
						<button type="button" id="cancel-withdrawal"
								class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
							Cancelar
						</button>

						<button type="submit" class="btn-primary flex items-center" id="confirm-withdrawal">
							<span>Solicitar Retiro</span>
							<i class="fas fa-arrow-right ml-2"></i>
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

    <div id="referral-modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Compartir Código de Referido</h2>
                    <button id="close-referral-modal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="text-center mb-6">
                    <p class="text-gray-600 mb-4">Comparte tu código único y gana $25 por cada amigo que se registre y realice su primer depósito.</p>
                    <div class="bg-gradient-to-r from-purple-500 to-pink-600 text-white p-6 rounded-xl inline-block">
                        <p class="text-sm mb-2">Tu código de referido:</p>
                        <p id="modal-referral-code" class="text-2xl font-bold">CARGANDO...</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">Compartir en:</label>
                    <div class="flex justify-center space-x-4">
                        <button class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700">
                            <i class="fab fa-facebook-f"></i>
                        </button>
                        <button class="w-12 h-12 bg-blue-400 rounded-full flex items-center justify-center text-white hover:bg-blue-500">
                            <i class="fab fa-twitter"></i>
                        </button>
                        <button class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white hover:bg-green-600">
                            <i class="fab fa-whatsapp"></i>
                        </button>
                        <button class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-white hover:bg-gray-900">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">O copia tu enlace personalizado:</label>
                    <div class="flex">
                        <input type="text" id="referral-link" class="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                        <button id="copy-referral-link" class="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">Código QR para compartir:</label>
                    <div class="flex justify-center">
                        <div id="qr-code" class="w-48 h-48 bg-white p-4 rounded-lg border border-gray-300">
                            <div class="text-center text-gray-500 py-12">
                                <i class="fas fa-qrcode text-3xl mb-2"></i>
                                <p class="text-sm">Código QR</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button id="close-referral-modal-2" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBI4O0d_Mec38FDiuhirujCnX99PFKiXW4",
            authDomain: "projekt-pc.firebaseapp.com",
            databaseURL: "https://projekt-pc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "projekt-pc",
            storageBucket: "projekt-pc.appspot.com",
            messagingSenderId: "90098431634",
            appId: "1:90098431634:web:7cb61800d03533c2a6984b",
            measurementId: "G-59YH8W8W1L"
        };

        firebase.initializeApp(firebaseConfig);
        
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();
    </script>

    <script>
        const appState = {
            currentUser: null,
            userData: null,
            transactions: [],
            deposits: [],
            withdrawals: [],
            referrals: [],
            earningsTimer: null,
            performanceChart: null,
            dailyEarnings: 0,
            totalEarnings: 0,
            referralBonus: 0
        };

        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterLink = document.getElementById('show-register');
        const showLoginLink = document.getElementById('show-login');
        const loginFormElement = document.getElementById('loginForm');
        const registerFormElement = document.getElementById('registerForm');
        const logoutButton = document.getElementById('logout-button');
        const userMenuButton = document.getElementById('user-menu-button');
        const userMenu = document.getElementById('user-menu');
        const userName = document.getElementById('user-name');
        const dashboardUserName = document.getElementById('dashboard-user-name');
        const kycStatus = document.getElementById('kyc-status');
        const totalBalance = document.getElementById('total-balance');
        const totalDeposits = document.getElementById('total-deposits');
        const totalEarnings = document.getElementById('total-earnings');
        const totalReferrals = document.getElementById('total-referrals');
        const performancePercentage = document.getElementById('performance-percentage');

        const kycForm = document.getElementById('kyc-form');
        const kycFullName = document.getElementById('kyc-full-name');
        const kycStatusBadge = document.getElementById('kyc-status-badge');
        const refreshKycStatus = document.getElementById('refresh-kyc-status');
        const submitKycButton = document.getElementById('submit-kyc');

        let kycFiles = {
            id_front: null,
            id_back: null,
            selfie: null,
            proof_of_address: null
        };
        
        const depositModal = document.getElementById('deposit-modal');
        const openDepositModalButton = document.getElementById('open-deposit-modal');
        const openDepositModalFromSectionButton = document.getElementById('open-deposit-modal-from-section');
        const closeDepositModalButton = document.getElementById('close-deposit-modal');
        const cancelDepositButton = document.getElementById('cancel-deposit');
        const depositForm = document.getElementById('deposit-form');
        
        const withdrawalModal = document.getElementById('withdrawal-modal');
        const openWithdrawalModalButton = document.getElementById('open-withdrawal-modal');
        const openWithdrawalModalFromSectionButton = document.getElementById('open-withdrawal-modal-from-section');
        const closeWithdrawalModalButton = document.getElementById('close-withdrawal-modal');
        const cancelWithdrawalButton = document.getElementById('cancel-withdrawal');
        const withdrawalForm = document.getElementById('withdrawal-form');
        const availableBalance = document.getElementById('available-balance');
        
        const referralModal = document.getElementById('referral-modal');
        const openReferralModalButton = document.getElementById('open-referral-modal');
        const closeReferralModalButton = document.getElementById('close-referral-modal');
        const closeReferralModalButton2 = document.getElementById('close-referral-modal-2');
        const modalReferralCode = document.getElementById('modal-referral-code');
        const referralLink = document.getElementById('referral-link');
        const copyReferralLink = document.getElementById('copy-referral-link');
        
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const filePreview = document.getElementById('file-preview');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const removeFileButton = document.getElementById('remove-file');
        const paymentMethods = document.querySelectorAll('input[name="payment-method"]');
        const paymentDetails = document.getElementById('payment-details');
        const submitDepositButton = document.getElementById('submit-deposit');
        
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.section');
        
        const referralCode = document.getElementById('referral-code');
        const copyReferralCode = document.getElementById('copy-referral-code');
        const referralsCount = document.getElementById('referrals-count');
        const activateReferralInput = document.getElementById('activate-referral-input');
        const activateReferralButton = document.getElementById('activate-referral-button');
        
        const profileForm = document.getElementById('profile-form');
        const changePasswordButton = document.getElementById('change-password');
        const saveInternationalSettingsButton = document.getElementById('save-international-settings');
        
        const faqQuestions = document.querySelectorAll('.faq-question');
        
        const earningsProjectionContainer = document.getElementById('earnings-projection-container');
        const earningsProjection = document.getElementById('earnings-projection');
        const toggleProjectionButton = document.getElementById('toggle-projection');

        let selectedFile = null;

        document.addEventListener('DOMContentLoaded', initApp);
        showRegisterLink.addEventListener('click', showRegisterForm);
        showLoginLink.addEventListener('click', showLoginForm);
        loginFormElement.addEventListener('submit', handleLogin);
        registerFormElement.addEventListener('submit', handleRegister);
        logoutButton.addEventListener('click', handleLogout);
        userMenuButton.addEventListener('click', toggleUserMenu);
        
        openDepositModalButton.addEventListener('click', openDepositModal);
        openDepositModalFromSectionButton.addEventListener('click', openDepositModal);
        closeDepositModalButton.addEventListener('click', closeDepositModal);
        cancelDepositButton.addEventListener('click', closeDepositModal);
        depositForm.addEventListener('submit', handleDeposit);

		if (openWithdrawalModalButton) {
			openWithdrawalModalButton.addEventListener('click', openWithdrawalModal);
		}
		if (openWithdrawalModalFromSectionButton) {
			openWithdrawalModalFromSectionButton.addEventListener('click', openWithdrawalModal);
		}
		if (closeWithdrawalModalButton) {
			closeWithdrawalModalButton.addEventListener('click', closeWithdrawalModal);
		}
		if (cancelWithdrawalButton) {
			cancelWithdrawalButton.addEventListener('click', closeWithdrawalModal);
		}
		if (withdrawalForm) {
			withdrawalForm.addEventListener('submit', handleWithdrawal);
		}

		if (openReferralModalButton) {
			openReferralModalButton.addEventListener('click', openReferralModal);
		}
		if (closeReferralModalButton) {
			closeReferralModalButton.addEventListener('click', closeReferralModal);
		}
		if (closeReferralModalButton2) {
			closeReferralModalButton2.addEventListener('click', closeReferralModal);
		}
		if (copyReferralLink) {
			copyReferralLink.addEventListener('click', copyToClipboard);
		}
		if (copyReferralCode) {
			copyReferralCode.addEventListener('click', copyToClipboard);
		}

		if (dropZone) {
			dropZone.addEventListener('click', () => fileInput && fileInput.click());
			dropZone.addEventListener('dragover', handleDragOver);
			dropZone.addEventListener('dragleave', handleDragLeave);
			dropZone.addEventListener('drop', handleDrop);
		}

		if (fileInput) {
			fileInput.addEventListener('change', handleFileSelect);
		}

		if (removeFileButton) {
			removeFileButton.addEventListener('click', removeSelectedFile);
		}

		if (paymentMethods) {
			paymentMethods.forEach(method => {
				if (method) {
					method.addEventListener('change', updatePaymentDetails);
				}
			});
		}

        
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = item.getAttribute('data-section');
                switchSection(sectionId);
                
                navItems.forEach(navItem => navItem.classList.remove('active'));
                item.classList.add('active');
            });
        });
        
        profileForm.addEventListener('submit', handleProfileUpdate);
        if (changePasswordButton) {
            changePasswordButton.addEventListener('click', handlePasswordChange);
        }
        
        if (saveInternationalSettingsButton) {
            saveInternationalSettingsButton.addEventListener('click', handleInternationalSettings);
        }
        
        faqQuestions.forEach(question => {
            question.addEventListener('click', () => {
                const answer = question.nextElementSibling;
                answer.classList.toggle('hidden');
            });
        });

        if (activateReferralButton) {
            activateReferralButton.addEventListener('click', handleReferralActivation);
        }

        if (toggleProjectionButton) {
            toggleProjectionButton.addEventListener('click', () => {
                earningsProjectionContainer.classList.toggle('visible');
            });
        }

        function initApp() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    appState.currentUser = user;
                    loadUserData();
                    showDashboard();
                    
                    startEarningsTimer();
                    
                    setTimeout(() => {
                        initKYC();
                    }, 500);
                } else {
                    showAuth();
                    
                    if (appState.earningsTimer) {
                        clearInterval(appState.earningsTimer);
                        appState.earningsTimer = null;
                    }
                    
                    window.kycInitialized = false;
                }
            });
            
            document.querySelectorAll('.withdrawal-method').forEach(method => {
                method.addEventListener('click', () => {
                    updateWithdrawalDetails();
                });
            });
            
            setTimeout(() => {
                updateWithdrawalDetails();
            }, 100);
        }

        function showAuth() {
            authSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
        }

        function showDashboard() {
            authSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
            updateDashboard();
        }

        function showRegisterForm(e) {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        }

        function showLoginForm(e) {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const referralCodeInput = document.getElementById('referral-code-input').value;
            
            if (!email || !password) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            showNotification('Iniciando sesión...', 'warning');
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    if (referralCodeInput.trim() !== '') {
                        validateAndApplyReferralCode(referralCodeInput, userCredential.user);
                    }
                    showNotification('¡Inicio de sesión exitoso!', 'success');
                })
                .catch(error => {
                    console.error('Login error:', error);
                    let errorMessage = 'Error al iniciar sesión';
                    
                    switch(error.code) {
                        case 'auth/user-not-found':
                            errorMessage = 'Usuario no encontrado';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Contraseña incorrecta';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Correo electrónico inválido';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'Cuenta deshabilitada';
                            break;
                        case 'auth/too-many-requests':
                            errorMessage = 'Demasiados intentos. Intenta más tarde';
                            break;
                        default:
                            errorMessage = 'Error: ' + error.message;
                    }
                    
                    showNotification(errorMessage, 'error');
                });
        }

        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const country = document.getElementById('register-country').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const referralCode = document.getElementById('register-referral-code').value;
            const termsAccepted = document.getElementById('register-terms').checked;
            
            if (!name || !email || !phone || !country || !password || !confirmPassword) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Por favor ingresa un correo electrónico válido', 'error');
                return;
            }
            
            if (password.length < 8) {
                showNotification('La contraseña debe tener al menos 8 caracteres', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            if (!termsAccepted) {
                showNotification('Debes aceptar los términos y condiciones', 'error');
                return;
            }
            
            showNotification('Creando cuenta...', 'warning');
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    
                    const userReferralCode = generateReferralCode();
                    
                    const userData = {
                        name: name,
                        email: email,
                        phone: phone,
                        country: country,
                        referralCode: userReferralCode,
                        referredBy: referralCode || null,
                        kycStatus: 'pending',
                        balance: 0,
                        totalDeposits: 0,
                        totalEarnings: 0,
                        totalReferrals: 0,
                        referralBonus: 0,
                        dailyEarnings: 0,
                        lastEarningsCalculation: Date.now(),
                        createdAt: Date.now(),
                        updatedAt: Date.now()
                    };
                    
                    return db.ref('users/' + user.uid).set(userData);
                })
                .then(() => {
                    showNotification('¡Cuenta creada exitosamente!', 'success');
                    showLoginForm(e);
                    
                    if (referralCode.trim() !== '') {
                        validateAndApplyReferralCode(referralCode, auth.currentUser);
                    }
                })
                .catch(error => {
                    console.error('Registration error:', error);
                    let errorMessage = 'Error al crear la cuenta';
                    
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'El correo electrónico ya está en uso';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Correo electrónico inválido';
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage = 'Operación no permitida';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'La contraseña es demasiado débil';
                            break;
                        default:
                            errorMessage = 'Error: ' + error.message;
                    }
                    
                    showNotification(errorMessage, 'error');
                });
        }

        function validateAndApplyReferralCode(code, user) {
            db.ref('users').orderByChild('referralCode').equalTo(code).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const referrerData = Object.values(snapshot.val())[0];
                        const referrerId = Object.keys(snapshot.val())[0];
                        
                        const referrerBonus = (referrerData.referralBonus || 0) + 25;
                        const referrerReferrals = (referrerData.totalReferrals || 0) + 1;
                        
                        db.ref('users/' + referrerId).update({
                            referralBonus: referrerBonus,
                            totalReferrals: referrerReferrals,
                            updatedAt: Date.now()
                        });
                        
                        const referralId = generateId();
                        const referralData = {
                            referredUserId: user.uid,
                            referredUserName: user.email,
                            referrerId: referrerId,
                            referrerName: referrerData.name,
                            bonus: 25,
                            activated: false,
                            createdAt: Date.now()
                        };
                        
                        db.ref('referrals/' + referrerId + '/' + referralId).set(referralData);
                        
                        showNotification('¡Código de referido aplicado correctamente! Recibirás $25 después de tu primer depósito.', 'success');
                    } else {
                        showNotification('Código de referido inválido', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error validating referral code:', error);
                    showNotification('Error al validar el código de referido', 'error');
                });
        }

        function handleLogout() {
            if (appState.earningsTimer) {
                clearInterval(appState.earningsTimer);
                appState.earningsTimer = null;
            }
            
            window.kycInitialized = false;
            
            kycFiles = {
                id_front: null,
                id_back: null,
                selfie: null,
                proof_of_address: null
            };
            
            auth.signOut()
                .then(() => {
                    showNotification('Sesión cerrada correctamente', 'success');
                })
                .catch(error => {
                    console.error('Logout error:', error);
                    showNotification('Error al cerrar sesión', 'error');
                });
        }

        function toggleUserMenu() {
            userMenu.classList.toggle('hidden');
        }

        function loadUserData() {
            if (!appState.currentUser) return;
            
            const userRef = db.ref('users/' + appState.currentUser.uid);
            
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    appState.userData = data;
                    
                    calculateDailyEarnings();
                    
                    updateUIWithUserData();
                    updateDashboard();
                    
                    loadUserTransactions();
                    loadUserDeposits();
                    loadUserWithdrawals();
                    loadUserReferrals();
                    updateKYCStatus();
                    
                    if (data.totalDeposits > 0) {
                        generateEarningsProjection();
                        earningsProjectionContainer.classList.add('visible');
                    } else {
                        earningsProjectionContainer.classList.remove('visible');
                    }
                } else {
                    console.error('No user data found');
                }
            });
        }

        function loadUserTransactions() {
            if (!appState.currentUser) return;
            
            const transactionsRef = db.ref('transactions/' + appState.currentUser.uid);
            
            transactionsRef.orderByChild('createdAt').limitToLast(10).on('value', (snapshot) => {
                appState.transactions = [];
                snapshot.forEach((childSnapshot) => {
                    appState.transactions.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                appState.transactions.reverse();
                updateTransactionsList();
            });
        }

        function loadUserDeposits() {
            if (!appState.currentUser) return;
            
            const depositsRef = db.ref('deposits/' + appState.currentUser.uid);
            
            depositsRef.orderByChild('createdAt').limitToLast(10).on('value', (snapshot) => {
                appState.deposits = [];
                snapshot.forEach((childSnapshot) => {
                    appState.deposits.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                appState.deposits.reverse();
                updateDepositsList();
            });
        }

        function loadUserWithdrawals() {
            if (!appState.currentUser) return;
            
            const withdrawalsRef = db.ref('withdrawals/' + appState.currentUser.uid);
            
            withdrawalsRef.orderByChild('createdAt').limitToLast(10).on('value', (snapshot) => {
                appState.withdrawals = [];
                snapshot.forEach((childSnapshot) => {
                    appState.withdrawals.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                appState.withdrawals.reverse();
                updateWithdrawalsList();
            });
        }

        function loadUserReferrals() {
            if (!appState.currentUser) return;
            
            const referralsRef = db.ref('referrals/' + appState.currentUser.uid);
            
            referralsRef.on('value', (snapshot) => {
                appState.referrals = [];
                snapshot.forEach((childSnapshot) => {
                    appState.referrals.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                updateReferralsList();
            });
        }

        function updateUIWithUserData() {
            if (!appState.userData) return;
            
            userName.textContent = appState.userData.name;
            dashboardUserName.textContent = appState.userData.name;
            
            kycStatus.textContent = `KYC ${appState.userData.kycStatus === 'verified' ? 'Verificado' : 'Pendiente'}`;
            kycStatus.className = `kyc-status ${appState.userData.kycStatus === 'verified' ? 'kyc-verified' : 'kyc-pending'}`;
            
            if (appState.userData.referralCode) {
                referralCode.textContent = appState.userData.referralCode;
                modalReferralCode.textContent = appState.userData.referralCode;
                referralLink.value = `${window.location.origin}?ref=${appState.userData.referralCode}`;
            }
            
            document.getElementById('profile-name').value = appState.userData.name || '';
            document.getElementById('profile-email').value = appState.userData.email || '';
            document.getElementById('profile-phone').value = appState.userData.phone || '';
            document.getElementById('profile-country').value = appState.userData.country || '';
            document.getElementById('profile-document-type').value = appState.userData.documentType || '';
            document.getElementById('profile-document-number').value = appState.userData.documentNumber || '';
            
            document.getElementById('international-bank-name').value = appState.userData.internationalBankName || '';
            document.getElementById('swift-code').value = appState.userData.swiftCode || '';
            document.getElementById('iban-number').value = appState.userData.ibanNumber || '';
        }

        function updateDashboard() {
            if (!appState.userData) return;
            
            const totalDepositsValue = appState.userData.totalDeposits || 0;
            const totalEarningsValue = appState.userData.totalEarnings || 0;
            const totalBalanceValue = totalDepositsValue + totalEarningsValue + (appState.userData.referralBonus || 0);
            
            totalBalance.textContent = `$${totalBalanceValue.toFixed(2)}`;
            totalDeposits.textContent = `$${totalDepositsValue.toFixed(2)}`;
            totalEarnings.textContent = `$${totalEarningsValue.toFixed(2)}`;
            totalReferrals.textContent = appState.userData.totalReferrals || '0';
            
            let performancePercentageValue = 0;
            if (totalDepositsValue > 0) {
                performancePercentageValue = (totalEarningsValue / totalDepositsValue * 100).toFixed(2);
            }
            
            performancePercentage.textContent = `+${performancePercentageValue}% desde el inicio`;
            
            availableBalance.textContent = `$${totalBalanceValue.toFixed(2)}`;
            
            const performanceEarningsElement = document.getElementById('performance-earnings');
            const performanceTotalElement = document.getElementById('performance-total');
            const performanceCapitalElement = document.getElementById('performance-capital');
            const dailyEarningsElement = document.getElementById('daily-earnings');
            
            if (performanceEarningsElement) {
                performanceEarningsElement.textContent = `$${totalEarningsValue.toFixed(2)}`;
            }
            
            if (performanceTotalElement) {
                performanceTotalElement.textContent = `+${performancePercentageValue}%`;
            }
            
            if (performanceCapitalElement) {
                performanceCapitalElement.textContent = `$${totalDepositsValue.toFixed(2)}`;
            }
            
            if (dailyEarningsElement) {
                const dailyRate = 0.125 / 30;
                const dailyEarnings = totalDepositsValue * dailyRate;
                dailyEarningsElement.textContent = `$${dailyEarnings.toFixed(2)}`;
            }
            
            referralsCount.textContent = appState.userData.totalReferrals || '0';
            
			setTimeout(() => {
				if (document.getElementById('performance-chart')) {
					initPerformanceChart();
					setupChartPeriodButtons();
                }
            }, 500);
        }

        function calculateDailyEarnings() {
            if (!appState.userData) return;
            
            const userData = appState.userData;
            const totalDeposits = userData.totalDeposits || 0;
            
            if (totalDeposits <= 0) return;
            
            const lastCalculation = userData.lastEarningsCalculation || userData.createdAt || Date.now();
            const now = Date.now();
            const timeDiff = now - lastCalculation;
            const daysDiff = timeDiff / (1000 * 60 * 60 * 24);
            
            if (daysDiff >= 1) {
                const dailyRate = 0.125 / 30;
                const earnings = totalDeposits * dailyRate * daysDiff;
                const newEarnings = (userData.totalEarnings || 0) + earnings;
                
                db.ref('users/' + appState.currentUser.uid).update({
                    totalEarnings: newEarnings,
                    lastEarningsCalculation: now,
                    updatedAt: now
                })
                .then(() => {
                    appState.userData.totalEarnings = newEarnings;
                    appState.userData.lastEarningsCalculation = now;
                    
                    console.log(`Earnings calculated: $${earnings.toFixed(2)} for ${daysDiff.toFixed(2)} days`);
                    
                    updateDashboard();
                })
                .catch(error => {
                    console.error('Error calculating earnings:', error);
                });
            }
        }

        function startEarningsTimer() {
            appState.earningsTimer = setInterval(() => {
                if (appState.currentUser && appState.userData) {
                    calculateDailyEarnings();
                }
            }, 60 * 60 * 1000);
            
            setInterval(() => {
                if (appState.currentUser && appState.userData) {
                    updateDashboard();
                }
            }, 60 * 1000);
        }

        function generateEarningsProjection() {
            if (!earningsProjection) return;
            
            const totalDeposits = appState.userData?.totalDeposits || 0;
            const currentEarnings = appState.userData?.totalEarnings || 0;
            const dailyRate = 0.125 / 30;
            
            if (totalDeposits <= 0) {
                earningsProjection.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p>Realiza un depósito para ver la proyección de ganancias</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            let accumulatedEarnings = currentEarnings;
            
            for (let day = 1; day <= 30; day++) {
                const dailyEarnings = totalDeposits * dailyRate;
                accumulatedEarnings += dailyEarnings;
                const totalBalance = totalDeposits + accumulatedEarnings;
                
                const isToday = day === 1;
                const rowClass = isToday ? 'bg-blue-50' : '';
                
                html += `
                    <tr class="${rowClass}">
                        <td class="py-2 px-4">Día ${day}${isToday ? ' (Hoy)' : ''}</td>
                        <td class="py-2 px-4">$${totalDeposits.toFixed(2)}</td>
                        <td class="py-2 px-4 text-green-600">+$${dailyEarnings.toFixed(2)}</td>
                        <td class="py-2 px-4">$${accumulatedEarnings.toFixed(2)}</td>
                        <td class="py-2 px-4 font-bold">$${totalBalance.toFixed(2)}</td>
                    </tr>
                `;
            }
            
            earningsProjection.innerHTML = `
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="py-2 px-4 text-left">Día</th>
                            <th class="py-2 px-4 text-left">Depósito</th>
                            <th class="py-2 px-4 text-left">Ganancias Diarias</th>
                            <th class="py-2 px-4 text-left">Ganancias Acumuladas</th>
                            <th class="py-2 px-4 text-left">Balance Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${html}
                    </tbody>
                </table>
            `;
        }

		function initPerformanceChart() {
			const ctx = document.getElementById('performance-chart');
			if (!ctx) return;
			
			if (appState.performanceChart instanceof Chart) {
				appState.performanceChart.destroy();
			}
			
			const userData = appState.userData;
			const totalDeposits = userData?.totalDeposits || 0;
			const totalEarnings = userData?.totalEarnings || 0;
			const currentBalance = totalDeposits + totalEarnings;
			
			const labels = [];
			const today = new Date();
			for (let i = 6; i >= 0; i--) {
				const date = new Date();
				date.setDate(today.getDate() - i);
				labels.push(date.toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric' }));
			}
			
			const depositsData = [];
			const earningsData = [];
			const balanceData = [];
			
			let currentDeposit = totalDeposits > 0 ? totalDeposits * 0.1 : 100;
			let currentEarning = 0;
			
			for (let i = 0; i < 7; i++) {
				if (i < 4 && totalDeposits > 0) {
					currentDeposit += (totalDeposits - currentDeposit) * 0.25;
				} else if (totalDeposits > 0) {
					currentDeposit = totalDeposits;
				} else {
					currentDeposit = 0;
				}
				
				if (i > 1 && currentDeposit > 0) {
					currentEarning += currentDeposit * (0.125 / 30) * (i - 1);
				}
				
				depositsData.push(currentDeposit);
				earningsData.push(currentEarning);
				balanceData.push(currentDeposit + currentEarning);
			}
			
			if (totalDeposits > 0) {
				depositsData[6] = totalDeposits;
				earningsData[6] = totalEarnings;
				balanceData[6] = currentBalance;
			}
			
			appState.performanceChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: labels,
					datasets: [
						{
							label: 'Depósitos',
							data: depositsData,
							borderColor: '#3b82f6',
							backgroundColor: 'rgba(59, 130, 246, 0.1)',
							borderWidth: 2,
							fill: true,
							tension: 0.4,
							pointRadius: 3,
							pointHoverRadius: 6
						},
						{
							label: 'Ganancias',
							data: earningsData,
							borderColor: '#10b981',
							backgroundColor: 'rgba(16, 185, 129, 0.1)',
							borderWidth: 2,
							fill: true,
							tension: 0.4,
							pointRadius: 3,
							pointHoverRadius: 6
						},
						{
							label: 'Balance Total',
							data: balanceData,
							borderColor: '#8b5cf6',
							backgroundColor: 'transparent',
							borderWidth: 3,
							borderDash: [5, 5],
							tension: 0.4,
							pointRadius: 3,
							pointHoverRadius: 8,
							pointBackgroundColor: '#8b5cf6',
							pointBorderColor: '#ffffff',
							pointBorderWidth: 2
						}
					]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					interaction: {
						mode: 'index',
						intersect: false,
					},
					plugins: {
						legend: {
							display: false
						},
						tooltip: {
							backgroundColor: 'rgba(255, 255, 255, 0.95)',
							titleColor: '#1f2937',
							bodyColor: '#1f2937',
							borderColor: '#e5e7eb',
							borderWidth: 1,
							cornerRadius: 8,
							padding: 12,
							boxPadding: 6,
							usePointStyle: true,
							callbacks: {
								label: function(context) {
									let label = context.dataset.label || '';
									if (label) {
										label += ': ';
									}
									if (context.parsed.y !== null) {
										label += new Intl.NumberFormat('es-ES', {
											style: 'currency',
											currency: 'USD',
											minimumFractionDigits: 2
										}).format(context.parsed.y);
									}
									return label;
								}
							}
						}
					},
					scales: {
						x: {
							grid: {
								display: false,
								drawBorder: false
							},
							ticks: {
								maxTicksLimit: 7,
								color: '#6b7280',
								font: {
									size: 11
								}
							}
						},
						y: {
							beginAtZero: true,
							suggestedMax: totalDeposits > 0 ? currentBalance * 1.2 : 1000,
							grid: {
								color: 'rgba(229, 231, 235, 0.5)',
								drawBorder: false
							},
							ticks: {
								color: '#6b7280',
								font: {
									size: 11
								},
								callback: function(value) {
									if (value >= 1000) {
										return '$' + (value / 1000).toFixed(1) + 'k';
									}
								 return '$' + value;
								}
							}
						}
					}
				}
			});
			
			const totalReturn = totalDeposits > 0 ? ((currentBalance - totalDeposits) / totalDeposits * 100).toFixed(2) : 0;
			const dailyReturn = (0.125 / 30 * 100).toFixed(2);
			const monthlyProjection = totalDeposits * 0.125;
			
			document.getElementById('chart-total-return').textContent = `+${totalReturn}%`;
			document.getElementById('chart-daily-return').textContent = `+${dailyReturn}%`;
			document.getElementById('chart-monthly-rate').textContent = `12.5%`;
			document.getElementById('chart-monthly-projection').textContent = `$${monthlyProjection.toFixed(2)}`;
			
			const createdAt = appState.userData?.createdAt || Date.now();
			const investmentDays = Math.floor((Date.now() - createdAt) / (1000 * 60 * 60 * 24));
			document.getElementById('chart-investment-time').textContent = `${investmentDays} días`;
			
			document.querySelectorAll('.chart-period-btn').forEach(btn => {
				btn.addEventListener('click', function() {
					document.querySelectorAll('.chart-period-btn').forEach(b => {
						b.classList.remove('bg-blue-100', 'text-blue-600', 'font-medium');
						b.classList.add('bg-gray-100', 'text-gray-700');
					});
					this.classList.remove('bg-gray-100', 'text-gray-700');
					this.classList.add('bg-blue-100', 'text-blue-600', 'font-medium');
				});
			});
		}

        function updateTransactionsList() {
            const transactionsList = document.getElementById('transactions-list');
            
            if (appState.transactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-exchange-alt text-3xl mb-2"></i>
                        <p>No hay transacciones recientes</p>
                    </div>
                `;
                return;
            }
            
            let transactionsHTML = '';
            
            appState.transactions.forEach(transaction => {
                const isPositive = transaction.type === 'deposit' || transaction.type === 'earning' || transaction.type === 'referral';
                const iconClass = transaction.type === 'deposit' ? 'fa-arrow-up text-blue-600' : 
                                transaction.type === 'withdrawal' ? 'fa-arrow-down text-red-600' : 
                                transaction.type === 'earning' ? 'fa-chart-line text-green-600' : 
                                'fa-gift text-purple-600';
                
                const typeText = transaction.type === 'deposit' ? 'Depósito' : 
                               transaction.type === 'withdrawal' ? 'Retiro' : 
                               transaction.type === 'earning' ? 'Rendimiento' : 
                               'Bono de Referido';
                
                const amountClass = isPositive ? 'positive' : 'negative';
                const amountPrefix = isPositive ? '+' : '-';
                
                transactionsHTML += `
                    <div class="transaction-item">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas ${iconClass}"></i>
                            </div>
                            <div>
                                <p class="font-medium">${typeText}</p>
                                <p class="text-sm text-gray-500">${formatDate(transaction.createdAt)}</p>
                            </div>
                        </div>
                        <div class="transaction-amount ${amountClass}">${amountPrefix}$${Math.abs(transaction.amount).toFixed(2)}</div>
                    </div>
                `;
            });
            
            transactionsList.innerHTML = transactionsHTML;
        }

        function updateDepositsList() {
            const depositsList = document.getElementById('deposits-list');
            
            if (appState.deposits.length === 0) {
                depositsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-wallet text-3xl mb-2"></i>
                        <p>No hay depósitos registrados</p>
                    </div>
                `;
                return;
            }
            
            let depositsHTML = '';
            
            appState.deposits.forEach(deposit => {
                const statusClass = deposit.status === 'approved' ? 'kyc-verified' : 
                                  deposit.status === 'rejected' ? 'kyc-rejected' : 'kyc-pending';
                const statusText = deposit.status === 'approved' ? 'Aprobado' : 
                                 deposit.status === 'rejected' ? 'Rechazado' : 'Pendiente';
                
                depositsHTML += `
                    <div class="transaction-item">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-arrow-up text-blue-600"></i>
                            </div>
                            <div>
                                <p class="font-medium">Depósito #${deposit.id.substring(0, 8)}</p>
                                <p class="text-sm text-gray-500">${formatDate(deposit.createdAt)} • ${deposit.method}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="transaction-amount positive mr-4">+$${deposit.amount.toFixed(2)}</span>
                            <span class="${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            });
            
            depositsList.innerHTML = depositsHTML;
        }

        function updateWithdrawalsList() {
            const withdrawalsList = document.getElementById('withdrawals-list');
            
            if (appState.withdrawals.length === 0) {
                withdrawalsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-money-bill-wave text-3xl mb-2"></i>
                        <p>No hay retiros registrados</p>
                    </div>
                `;
                return;
            }
            
            let withdrawalsHTML = '';
            
            appState.withdrawals.forEach(withdrawal => {
                const statusClass = withdrawal.status === 'approved' ? 'kyc-verified' : 
                                  withdrawal.status === 'rejected' ? 'kyc-rejected' : 'kyc-pending';
                const statusText = withdrawal.status === 'approved' ? 'Aprobado' : 
                                 withdrawal.status === 'rejected' ? 'Rechazado' : 'Pendiente';
                
                withdrawalsHTML += `
                    <div class="transaction-item">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-arrow-down text-red-600"></i>
                            </div>
                            <div>
                                <p class="font-medium">Retiro #${withdrawal.id.substring(0, 8)}</p>
                                <p class="text-sm text-gray-500">${formatDate(withdrawal.createdAt)} • ${withdrawal.method}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="transaction-amount negative mr-4">-$${withdrawal.amount.toFixed(2)}</span>
                            <span class="${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            });
            
            withdrawalsList.innerHTML = withdrawalsHTML;
        }

        function updateReferralsList() {
            const referralsBonusList = document.getElementById('referrals-bonus-list');
            
            if (appState.referrals.length === 0) {
                referralsBonusList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-3xl mb-2"></i>
                        <p>No has recibido bonos por referidos aún</p>
                        <p class="text-sm mt-2">Comparte tu código para empezar a ganar</p>
                    </div>
                `;
                return;
            }
            
            let referralsHTML = '';
            
            appState.referrals.forEach(referral => {
                referralsHTML += `
                    <div class="transaction-item">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user-plus text-purple-600"></i>
                            </div>
                            <div>
                                <p class="font-medium">${referral.referredName || 'Usuario referido'}</p>
                                <p class="text-sm text-gray-500">${formatDate(referral.createdAt)}</p>
                            </div>
                        </div>
                        <div class="transaction-amount positive">+$${referral.bonus.toFixed(2)}</div>
                    </div>
                `;
            });
            
            referralsBonusList.innerHTML = referralsHTML;
        }

        function switchSection(sectionId) {
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
                
                if (sectionId === 'dashboard') {
                    setTimeout(() => {
                        if (!appState.performanceChart && document.getElementById('performance-chart')) {
                            initPerformanceChart();
                        }
                    }, 300);
                }
                
                if (sectionId === 'performance') {
                    setTimeout(() => {
                        generateEarningsProjection();
                    }, 300);
                }
                
                if (sectionId === 'kyc-verification') {
                    console.log('Accediendo a sección KYC');
                    if (!window.kycInitialized) {
                        setTimeout(() => {
                            initKYC();
                        }, 100);
                    } else {
                        updateKYCStatus();
                    }
                }
            }
        }

        function openDepositModal() {
            depositModal.classList.add('active');
            resetDepositForm();
        }

        function closeDepositModal() {
            depositModal.classList.remove('active');
            resetDepositForm();
        }

        function resetDepositForm() {
            depositForm.reset();
            removeSelectedFile();
            updatePaymentDetails();
        }

		function openWithdrawalModal() {
			if (!appState.userData) {
				showNotification('Cargando datos de usuario...', 'warning');
				return;
			}
			
			const totalDeposits = appState.userData.totalDeposits || 0;
			const totalEarnings = appState.userData.totalEarnings || 0;
			const referralBonus = appState.userData.referralBonus || 0;
			
			const availableBalanceCalc = totalDeposits + totalEarnings + referralBonus;
			
			if (availableBalanceCalc <= 0) {
				showNotification('No tienes saldo disponible para retirar', 'error');
				return;
			}
			
			withdrawalModal.classList.add('active');
			availableBalance.textContent = `$${availableBalanceCalc.toFixed(2)}`;
			
			updateWithdrawalDetails();
			
			withdrawalForm.reset();
		}

		function closeWithdrawalModal() {
			withdrawalModal.classList.remove('active');
			withdrawalForm.reset();
			updateWithdrawalDetails();
			
			const submitButton = document.getElementById('confirm-withdrawal');
			if (submitButton) {
				submitButton.disabled = false;
				submitButton.innerHTML = '<span>Solicitar Retiro</span><i class="fas fa-arrow-right ml-2"></i>';
			}
		}

        function openReferralModal() {
            if (!appState.userData || !appState.userData.referralCode) {
                showNotification('Cargando información de referidos...', 'warning');
                return;
            }
            
            referralModal.classList.add('active');
        }

        function closeReferralModal() {
            referralModal.classList.remove('active');
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            processSelectedFile(file);
        }

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('active');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            if (!dropZone.contains(e.relatedTarget)) {
                dropZone.classList.remove('active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('active');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processSelectedFile(files[0]);
            }
        }

        function processSelectedFile(file) {
            if (!file) return;
            
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
            if (!allowedTypes.includes(file.type)) {
                showNotification('Formato de archivo no permitido. Use PDF, JPG o PNG.', 'error');
                return;
            }
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                showNotification('El archivo es demasiado grande. El tamaño máximo es 5 MB.', 'error');
                return;
            }
            
            selectedFile = file;
            
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            filePreview.classList.remove('hidden');
            
            showNotification('Archivo seleccionado correctamente', 'success');
        }

        function removeSelectedFile() {
            selectedFile = null;
            fileInput.value = '';
            filePreview.classList.add('hidden');
        }

        function updatePaymentDetails() {
            const selectedMethod = document.querySelector('input[name="payment-method"]:checked');
            
            if (!selectedMethod) return;
            
            let detailsHTML = '';
            
            switch (selectedMethod.value) {
                case 'bank':
                    detailsHTML = `
                        <h3 class="font-bold mb-2">Instrucciones para Transferencia Bancaria</h3>
                        <p class="text-gray-600 mb-2">Realiza una transferencia a la siguiente cuenta:</p>
                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p><strong>Banco:</strong> Canada Coin Financial</p>
                            <p><strong>Cuenta:</strong> 1234567890</p>
                            <p><strong>SWIFT/BIC:</strong> CCFIUS33</p>
                            <p><strong>Beneficiario:</strong> Canada Coin Investments LLC</p>
                            <p><strong>Referencia:</strong> Tu correo electrónico o ID de usuario</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Una vez realizada la transferencia, sube el comprobante a continuación.</p>
                    `;
                    break;
                case 'paypal':
                    detailsHTML = `
                        <h3 class="font-bold mb-2">Instrucciones para PayPal</h3>
                        <p class="text-gray-600 mb-2">Realiza el pago a la siguiente dirección de PayPal:</p>
                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p><strong>Email de PayPal:</strong> payments@canadacoin.com</p>
                            <p><strong>Referencia:</strong> Tu correo electrónico o ID de usuario</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Una vez realizado el pago, sube el comprobante a continuación.</p>
                    `;
                    break;
                case 'crypto':
                    detailsHTML = `
                        <h3 class="font-bold mb-2">Instrucciones para Criptomonedas</h3>
                        <p class="text-gray-600 mb-2">Envía la criptomoneda a la siguiente dirección:</p>
                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p><strong>Bitcoin (BTC):</strong> 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</p>
                            <p><strong>Ethereum (ETH):</strong> 0x742d35Cc6634C0532925a3b8D4C9db7c1b7c8e8e</p>
                            <p><strong>USDT (ERC-20):</strong> 0x742d35Cc6634C0532925a3b8D4C9db7c1b7c8e8e</p>
                            <p><strong>Referencia:</strong> Tu correo electrónico o ID de usuario</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Una vez realizada la transacción, sube el comprobante a continuación.</p>
                    `;
                    break;
            }
            
            paymentDetails.innerHTML = detailsHTML;
        }

        function handleDeposit(e) {
            e.preventDefault();
            
            if (!appState.currentUser) {
                showNotification('Debes iniciar sesión para realizar un depósito', 'error');
                return;
            }
            
            const amountInput = document.getElementById('deposit-amount');
            const amount = parseFloat(amountInput.value);
            const methodElement = document.querySelector('input[name="payment-method"]:checked');
            
            if (!methodElement) {
                showNotification('Por favor selecciona un método de pago', 'error');
                return;
            }
            
            const method = methodElement.value;
            
            if (!amount || isNaN(amount) || amount < 100) {
                showNotification('El monto mínimo de depósito es $100 USD', 'error');
                amountInput.focus();
                return;
            }
            
            if (!selectedFile) {
                showNotification('Debes subir un comprobante de pago', 'error');
                return;
            }
            
            showNotification('Procesando depósito...', 'warning');
            
            const submitButton = document.getElementById('submit-deposit');
            submitButton.disabled = true;
            submitButton.innerHTML = '<span>Procesando...</span><i class="fas fa-spinner fa-spin ml-2"></i>';
            
            const depositId = generateId();
            
            const currentBalance = appState.userData?.balance || 0;
            const currentDeposits = appState.userData?.totalDeposits || 0;
            
            const depositData = {
                amount: amount,
                method: method,
                status: 'pending',
                userId: appState.currentUser.uid,
                userEmail: appState.currentUser.email,
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            
            const userUpdates = {
                balance: currentBalance + amount,
                totalDeposits: currentDeposits + amount,
                updatedAt: Date.now(),
                lastEarningsCalculation: Date.now()
            };
            
            db.ref('users/' + appState.currentUser.uid).update(userUpdates)
                .then(() => {
                    return db.ref('deposits/' + appState.currentUser.uid + '/' + depositId).set(depositData);
                })
                .then(() => {
                    const transactionData = {
                        type: 'deposit',
                        amount: amount,
                        method: method,
                        description: `Depósito #${depositId.substring(0, 8)}`,
                        status: 'pending',
                        createdAt: Date.now()
                    };
                    
                    return db.ref('transactions/' + appState.currentUser.uid).push(transactionData);
                })
                .then(() => {
                    if (selectedFile) {
                        const fileExtension = selectedFile.name.split('.').pop();
                        const fileName = `deposit_${depositId}.${fileExtension}`;
                        const fileRef = storage.ref().child(`deposits/${appState.currentUser.uid}/${fileName}`);
                        return fileRef.put(selectedFile);
                    }
                })
                .then(() => {
                    showNotification('¡Depósito enviado correctamente! Será revisado por nuestro equipo.', 'success');
                    closeDepositModal();
                    
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>Confirmar Depósito</span><i class="fas fa-arrow-right ml-2"></i>';
                })
                .catch(error => {
                    console.error('Error saving deposit:', error);
                    showNotification('Error al guardar el depósito: ' + error.message, 'error');
                    
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>Confirmar Depósito</span><i class="fas fa-arrow-right ml-2"></i>';
                });
        }

		function handleWithdrawal(e) {
			e.preventDefault();
			
			console.log('Iniciando solicitud de retiro...');
			
			if (!appState.currentUser) {
				showNotification('Debes iniciar sesión para solicitar un retiro', 'error');
				return;
			}
			
			const amountInput = document.getElementById('withdrawal-amount');
			const amount = parseFloat(amountInput.value);
			const methodElement = document.querySelector('input[name="withdrawal-method"]:checked');
			
			if (!methodElement) {
				showNotification('Por favor selecciona un método de retiro', 'error');
				return;
			}
			
			const method = methodElement.value;
			
			if (!amount || isNaN(amount) || amount < 10) {
				showNotification('El monto mínimo de retiro es $10 USD', 'error');
				amountInput.focus();
				return;
			}
			
			const totalDeposits = appState.userData?.totalDeposits || 0;
			const totalEarnings = appState.userData?.totalEarnings || 0;
			const referralBonus = appState.userData?.referralBonus || 0;
			const currentBalance = totalDeposits + totalEarnings + referralBonus;
			
			console.log('Cálculo de balance:', {
				totalDeposits,
				totalEarnings,
				referralBonus,
				currentBalance,
				amount
			});
			
			if (amount > currentBalance) {
				showNotification(`No tienes suficiente saldo disponible. Saldo: $${currentBalance.toFixed(2)}`, 'error');
				amountInput.focus();
				return;
			}
			
			let details = {};
			let valid = true;
			let errorMessage = '';
			let firstInvalidField = null;
			
			if (method === 'bank') {
				const bankName = document.getElementById('bank-name').value;
				const accountNumber = document.getElementById('account-number').value;
				const accountHolder = document.getElementById('account-holder').value;
				const accountType = document.getElementById('account-type').value;
				
				if (!bankName || !accountNumber || !accountHolder || !accountType) {
					errorMessage = 'Por favor completa todos los campos requeridos de información bancaria';
					valid = false;
					firstInvalidField = document.getElementById('bank-name');
				}
				
				if (valid) {
					details = {
						bankName: bankName,
						accountNumber: accountNumber,
						accountHolder: accountHolder,
						accountType: accountType
					};
				}
				
			} else if (method === 'paypal') {
				const paypalEmail = document.getElementById('paypal-email');
				if (!paypalEmail || !paypalEmail.value.trim()) {
					errorMessage = 'Por favor ingresa el correo electrónico de PayPal';
					valid = false;
					firstInvalidField = paypalEmail;
				} else {
					const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
					if (!emailRegex.test(paypalEmail.value)) {
						errorMessage = 'Por favor ingresa un correo electrónico válido para PayPal';
						valid = false;
						firstInvalidField = paypalEmail;
					}
				}
				
				if (valid) {
					details = {
						paypalEmail: paypalEmail.value
					};
				}
				
			} else if (method === 'crypto') {
				const cryptoWallet = document.getElementById('crypto-wallet').value;
				const cryptoNetwork = document.getElementById('crypto-network').value;
				
				if (!cryptoWallet || !cryptoNetwork) {
					errorMessage = 'Por favor completa todos los campos requeridos para criptomonedas';
					valid = false;
					firstInvalidField = document.getElementById('crypto-wallet');
				}
				
				if (valid && cryptoWallet.length < 10) {
					errorMessage = 'La dirección de la billetera es demasiado corta. Verifica que sea correcta.';
					valid = false;
					firstInvalidField = document.getElementById('crypto-wallet');
				}
				
				if (valid) {
					details = {
						walletAddress: cryptoWallet,
						network: cryptoNetwork
					};
				}
			} else if (method === 'international') {
				const bankCountry = document.getElementById('international-bank-country').value;
				const bankName = document.getElementById('international-bank-name').value;
				const accountType = document.getElementById('international-account-type').value;
				const currency = document.getElementById('international-currency').value;
				const accountNumber = document.getElementById('international-account-number').value;
				const routingNumber = document.getElementById('international-routing-number').value;
				const swiftCode = document.getElementById('international-swift-code').value;
				const accountHolder = document.getElementById('international-account-holder').value;
				
				if (!bankCountry || !bankName || !accountType || !currency || !accountNumber || !routingNumber || !swiftCode || !accountHolder) {
					errorMessage = 'Por favor completa todos los campos requeridos para transferencia internacional';
					valid = false;
					firstInvalidField = document.getElementById('international-bank-country');
				}
				
				if (valid) {
					details = {
						bankCountry: bankCountry,
						bankName: bankName,
						accountType: accountType,
						currency: currency,
						accountNumber: accountNumber,
						routingNumber: routingNumber,
						swiftCode: swiftCode,
						accountHolder: accountHolder,
						bankAddress: document.getElementById('international-bank-address')?.value || ''
					};
				}
			} else {
				errorMessage = 'Método de retiro no válido';
				valid = false;
			}
			
			if (!valid) {
				showNotification(errorMessage, 'error');
				if (firstInvalidField) {
					firstInvalidField.focus();
				}
				return;
			}
			
			showNotification('Procesando solicitud de retiro...', 'warning');
			
			const submitButton = document.getElementById('confirm-withdrawal');
			if (submitButton) {
				submitButton.disabled = true;
				submitButton.innerHTML = '<span>Procesando...</span><i class="fas fa-spinner fa-spin ml-2"></i>';
			}
			
			const withdrawalId = generateId();
			
			let withdrawalFee = 0;
			let netAmount = amount;
			
			if (method === 'international') {
				withdrawalFee = Math.max(amount * 0.05, 20);
				netAmount = amount - withdrawalFee;
			} else if (method === 'crypto') {
				withdrawalFee = Math.max(amount * 0.02, 5);
				netAmount = amount - withdrawalFee;
			} else {
				withdrawalFee = Math.max(amount * 0.02, 5);
				netAmount = amount - withdrawalFee;
			}
			
			console.log('Datos del retiro:', {
				amount: amount,
				netAmount: netAmount,
				fee: withdrawalFee,
				method: method,
				details: details
			});
			
			const withdrawalData = {
				amount: amount,
				netAmount: netAmount,
				fee: withdrawalFee,
				method: method,
				details: details,
				status: 'pending',
				userId: appState.currentUser.uid,
				userEmail: appState.currentUser.email,
				userName: appState.userData?.name || appState.currentUser.email,
				createdAt: Date.now(),
				updatedAt: Date.now()
			};
			
			db.ref('withdrawals/' + appState.currentUser.uid + '/' + withdrawalId).set(withdrawalData)
				.then(() => {
					console.log('Retiro guardado en Firebase');
					
					const transactionData = {
						type: 'withdrawal',
						amount: -amount,
						method: method,
						description: `Retiro #${withdrawalId.substring(0, 8)} (${method})`,
						fee: withdrawalFee,
						netAmount: netAmount,
						status: 'pending',
						createdAt: Date.now()
					};
					
					return db.ref('transactions/' + appState.currentUser.uid).push(transactionData);
				})
				.then(() => {
					console.log('Transacción registrada en Firebase');
					
					showNotification('¡Solicitud de retiro enviada correctamente! Será procesada en 3-5 días hábiles.', 'success');
					
					closeWithdrawalModal();
				})
				.catch(error => {
					console.error('Error saving withdrawal:', error);
					showNotification('Error al guardar la solicitud de retiro: ' + error.message, 'error');
					
					if (submitButton) {
						submitButton.disabled = false;
						submitButton.innerHTML = '<span>Solicitar Retiro</span><i class="fas fa-arrow-right ml-2"></i>';
					}
				});
		}

        function handleProfileUpdate(e) {
            e.preventDefault();
            
            if (!appState.currentUser) return;
            
            const name = document.getElementById('profile-name').value.trim();
            const email = document.getElementById('profile-email').value.trim();
            const phone = document.getElementById('profile-phone').value.trim();
            const country = document.getElementById('profile-country').value;
            const documentType = document.getElementById('profile-document-type').value;
            const documentNumber = document.getElementById('profile-document-number').value.trim();
            
            if (!name || !email || !phone || !country) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Por favor ingresa un correo electrónico válido', 'error');
                return;
            }
            
            showNotification('Actualizando perfil...', 'warning');
            
            const updates = {
                name: name,
                email: email,
                phone: phone,
                country: country,
                documentType: documentType,
                documentNumber: documentNumber,
                updatedAt: Date.now()
            };
            
            db.ref('users/' + appState.currentUser.uid).update(updates)
                .then(() => {
                    showNotification('Perfil actualizado correctamente', 'success');
                    updateUIWithUserData();
                })
                .catch(error => {
                    console.error('Error updating profile:', error);
                    showNotification('Error al actualizar el perfil', 'error');
                });
        }

        function handlePasswordChange() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;
            
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showNotification('La nueva contraseña debe tener al menos 8 caracteres', 'error');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            showNotification('Cambiando contraseña...', 'warning');
            
            const user = auth.currentUser;
            const credential = firebase.auth.EmailAuthProvider.credential(
                user.email,
                currentPassword
            );
            
            user.reauthenticateWithCredential(credential)
                .then(() => {
                    return user.updatePassword(newPassword);
                })
                .then(() => {
                    showNotification('Contraseña cambiada correctamente', 'success');
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    document.getElementById('confirm-new-password').value = '';
                })
                .catch(error => {
                    console.error('Error changing password:', error);
                    let errorMessage = 'Error al cambiar la contraseña';
                    
                    switch(error.code) {
                        case 'auth/wrong-password':
                            errorMessage = 'La contraseña actual es incorrecta';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'La nueva contraseña es demasiado débil';
                            break;
                        default:
                            errorMessage = 'Error: ' + error.message;
                    }
                    
                    showNotification(errorMessage, 'error');
                });
        }

        function handleInternationalSettings() {
            const bankName = document.getElementById('international-bank-name').value.trim();
            const swiftCode = document.getElementById('swift-code').value.trim();
            const ibanNumber = document.getElementById('iban-number').value.trim();
            
            if (!bankName || !swiftCode || !ibanNumber) {
                showNotification('Por favor completa todos los campos de configuración internacional', 'error');
                return;
            }
            
            showNotification('Guardando configuración internacional...', 'warning');
            
            const updates = {
                internationalBankName: bankName,
                swiftCode: swiftCode,
                ibanNumber: ibanNumber,
                updatedAt: Date.now()
            };
            
            db.ref('users/' + appState.currentUser.uid).update(updates)
                .then(() => {
                    showNotification('Configuración internacional guardada correctamente', 'success');
                })
                .catch(error => {
                    console.error('Error saving international settings:', error);
                    showNotification('Error al guardar la configuración internacional', 'error');
                });
        }

        function handleReferralActivation() {
            const code = activateReferralInput.value.trim();
            
            if (!code) {
                showNotification('Por favor ingresa un código de referido', 'error');
                return;
            }
            
            if (appState.userData.referredBy) {
                showNotification('Ya tienes un código de referido activado', 'error');
                return;
            }
            
            showNotification('Validando código de referido...', 'warning');
            
            db.ref('users').orderByChild('referralCode').equalTo(code).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const referrerData = Object.values(snapshot.val())[0];
                        const referrerId = Object.keys(snapshot.val())[0];
                        
                        return db.ref('users/' + appState.currentUser.uid).update({
                            referredBy: code,
                            updatedAt: Date.now()
                        }).then(() => {
                            const referrerBonus = (referrerData.referralBonus || 0) + 25;
                            const referrerReferrals = (referrerData.totalReferrals || 0) + 1;
                            
                            return db.ref('users/' + referrerId).update({
                                referralBonus: referrerBonus,
                                totalReferrals: referrerReferrals,
                                updatedAt: Date.now()
                            }).then(() => {
                                const referralId = generateId();
                                const referralData = {
                                    referredUserId: appState.currentUser.uid,
                                    referredUserName: appState.userData.email,
                                    referrerId: referrerId,
                                    referrerName: referrerData.name,
                                    bonus: 25,
                                    activated: false,
                                    createdAt: Date.now()
                                };
                                
                                return db.ref('referrals/' + referrerId + '/' + referralId).set(referralData);
                            });
                        });
                    } else {
                        throw new Error('Código de referido inválido');
                    }
                })
                .then(() => {
                    showNotification('¡Código de referido activado correctamente! Recibirás $25 después de tu primer depósito.', 'success');
                    activateReferralInput.value = '';
                })
                .catch(error => {
                    console.error('Error activating referral:', error);
                    showNotification(error.message, 'error');
                });
        }

        function copyToClipboard(e) {
            let textToCopy = '';
            
            if (e.target.id === 'copy-referral-link' || e.target.parentElement.id === 'copy-referral-link') {
                textToCopy = referralLink.value;
            } else if (e.target.id === 'copy-referral-code' || e.target.parentElement.id === 'copy-referral-code') {
                textToCopy = appState.userData.referralCode;
            } else {
                return;
            }
            
            if (!textToCopy || textToCopy === 'CARGANDO...') {
                showNotification('No hay contenido para copiar', 'error');
                return;
            }
            
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    showNotification('Copiado al portapapeles', 'success');
                })
                .catch(err => {
                    console.error('Error copying text: ', err);
                    
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        showNotification('Copiado al portapapeles', 'success');
                    } catch (err) {
                        showNotification('Error al copiar al portapapeles', 'error');
                    }
                    
                    document.body.removeChild(textArea);
                });
        }

        function initKYC() {
            console.log('Inicializando funcionalidad KYC...');
            
            if (!dashboardSection || dashboardSection.classList.contains('hidden')) {
                console.log('Dashboard no está visible, posponiendo inicialización KYC');
                return;
            }
            
            if (window.kycInitialized === true) {
                console.log('KYC ya está inicializado, omitiendo...');
                return;
            }
            
            window.kycInitialized = true;
            
            if (kycForm) {
                kycForm.removeEventListener('submit', handleKYCSubmit);
                kycForm.addEventListener('submit', handleKYCSubmit);
            }
            
            if (refreshKycStatus) {
                refreshKycStatus.removeEventListener('click', updateKYCStatus);
                refreshKycStatus.addEventListener('click', updateKYCStatus);
            }
            
            const dropZones = document.querySelectorAll('.kyc-drop-zone');
            
            dropZones.forEach(dropZone => {
                const docType = dropZone.getAttribute('data-doc-type');
                const fileInput = dropZone.querySelector('.kyc-file-input');
                
                if (!fileInput) return;
                
                const clickHandler = (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    fileInput.click();
                };
                
                const dragOverHandler = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropZone.classList.add('active');
                };
                
                const dragLeaveHandler = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!dropZone.contains(e.relatedTarget)) {
                        dropZone.classList.remove('active');
                    }
                };
                
                const dropHandler = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropZone.classList.remove('active');
                    
                    if (e.dataTransfer.files.length > 0) {
                        const file = e.dataTransfer.files[0];
                        processKYCFile(file, docType);
                    }
                };
                
                const fileChangeHandler = (e) => {
                    e.stopPropagation();
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        processKYCFile(file, docType);
                    }
                };
                
                dropZone.removeEventListener('click', clickHandler);
                dropZone.removeEventListener('dragover', dragOverHandler);
                dropZone.removeEventListener('dragleave', dragLeaveHandler);
                dropZone.removeEventListener('drop', dropHandler);
                fileInput.removeEventListener('change', fileChangeHandler);
                
                dropZone.addEventListener('click', clickHandler, true);
                dropZone.addEventListener('dragover', dragOverHandler, true);
                dropZone.addEventListener('dragleave', dragLeaveHandler, true);
                dropZone.addEventListener('drop', dropHandler, true);
                fileInput.addEventListener('change', fileChangeHandler, true);
            });
            
            if (appState.currentUser) {
                updateKYCStatus();
            }
        }

        function processKYCFile(file, docType) {
            if (!appState.currentUser) {
                showNotification('Debes iniciar sesión para subir documentos', 'error');
                return;
            }
            
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showNotification(`Formato de archivo no permitido para ${getDocTypeName(docType)}. Use JPG, PNG o PDF.`, 'error');
                return;
            }
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                showNotification(`El archivo es demasiado grande. El tamaño máximo es 5 MB para ${getDocTypeName(docType)}.`, 'error');
                return;
            }
            
            kycFiles[docType] = file;
            
            showKYCFilePreview(file, docType);
            
            showNotification(`Documento ${getDocTypeName(docType)} cargado correctamente`, 'success');
        }

        function getDocTypeName(docType) {
            const names = {
                'id_front': 'Documento Frente',
                'id_back': 'Documento Reverso',
                'selfie': 'Selfie con Documento',
                'proof_of_address': 'Comprobante de Domicilio'
            };
            return names[docType] || docType;
        }

        function showKYCFilePreview(file, docType) {
            const previewContainer = document.querySelector(`.kyc-file-preview[data-doc-type="${docType}"]`);
            if (!previewContainer) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const isImage = file.type.startsWith('image/');
                const isPDF = file.type === 'application/pdf';
                
                let previewHTML = '';
                
                if (isImage) {
                    previewHTML = `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-16 h-16 bg-gray-200 rounded-lg overflow-hidden mr-3">
                                    <img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <p class="font-medium">${file.name}</p>
                                    <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
                                    <p class="text-xs text-gray-400">${getDocTypeName(docType)}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="text-blue-600 hover:text-blue-800 view-kyc-file" data-file="${docType}" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 remove-kyc-file" data-file="${docType}" type="button">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } else if (isPDF) {
                    previewHTML = `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-16 h-16 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-file-pdf text-red-600 text-xl"></i>
                                </div>
                                <div>
                                    <p class="font-medium">${file.name}</p>
                                    <p class="text-sm text-gray-500">${formatFileSize(file.size)}</p>
                                    <p class="text-xs text-gray-400">${getDocTypeName(docType)} (PDF)</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="text-blue-600 hover:text-blue-800 view-kyc-file" data-file="${docType}" type="button">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 remove-kyc-file" data-file="${docType}" type="button">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                previewContainer.innerHTML = previewHTML;
                previewContainer.classList.remove('hidden');
                
                const viewButton = previewContainer.querySelector('.view-kyc-file');
                const removeButton = previewContainer.querySelector('.remove-kyc-file');
                
                if (viewButton) {
                    viewButton.addEventListener('click', () => viewKYCFile(docType));
                }
                
                if (removeButton) {
                    removeButton.addEventListener('click', () => removeKYCFile(docType));
                }
            };
            
            reader.readAsDataURL(file);
        }

        function viewKYCFile(docType) {
            const file = kycFiles[docType];
            if (!file) return;
            
            const fileURL = URL.createObjectURL(file);
            window.open(fileURL, '_blank');
        }

        function removeKYCFile(docType) {
            kycFiles[docType] = null;
            const previewContainer = document.querySelector(`.kyc-file-preview[data-doc-type="${docType}"]`);
            if (previewContainer) {
                previewContainer.innerHTML = '';
                previewContainer.classList.add('hidden');
            }
            
            const fileInput = document.querySelector(`.kyc-file-input[data-doc-type="${docType}"]`);
            if (fileInput) {
                fileInput.value = '';
            }
            
            showNotification(`Documento ${getDocTypeName(docType)} eliminado`, 'success');
        }

        function updateKYCStatus() {
            if (!appState.userData) return;
            
            const userKycStatus = appState.userData.kycStatus || 'pending';
            const kycData = appState.userData.kycData || {};
            
            if (kycStatus) {
                kycStatus.textContent = `KYC ${userKycStatus === 'verified' ? 'Verificado' : userKycStatus === 'rejected' ? 'Rechazado' : 'Pendiente'}`;
                kycStatus.className = `kyc-status ${userKycStatus === 'verified' ? 'kyc-verified' : userKycStatus === 'rejected' ? 'kyc-rejected' : 'kyc-pending'}`;
            }
            
            if (kycStatusBadge) {
                kycStatusBadge.textContent = `KYC ${userKycStatus === 'verified' ? 'Verificado' : userKycStatus === 'rejected' ? 'Rechazado' : 'Pendiente'}`;
                kycStatusBadge.className = `kyc-status ${userKycStatus === 'verified' ? 'kyc-verified' : userKycStatus === 'rejected' ? 'kyc-rejected' : 'kyc-pending'}`;
            }
            
            if (kycData.fullName && kycFullName) {
                kycFullName.value = kycData.fullName;
                document.getElementById('kyc-birthdate').value = kycData.birthdate || '';
                document.getElementById('kyc-id-type').value = kycData.idType || '';
                document.getElementById('kyc-id-number').value = kycData.idNumber || '';
                document.getElementById('kyc-id-country').value = kycData.idCountry || '';
                document.getElementById('kyc-address').value = kycData.address || '';
            } else if (kycFullName && appState.userData.name) {
                kycFullName.value = appState.userData.name || '';
            }
            
            if (kycForm && (userKycStatus === 'verified' || userKycStatus === 'rejected')) {
                kycForm.querySelectorAll('input, select, textarea, button').forEach(el => {
                    el.disabled = true;
                });
                if (submitKycButton) {
                    submitKycButton.innerHTML = '<i class="fas fa-check mr-2"></i> KYC Ya Enviado';
                    submitKycButton.disabled = true;
                }
            } else if (kycForm) {
                kycForm.querySelectorAll('input, select, textarea').forEach(el => {
                    el.disabled = false;
                });
                if (submitKycButton) {
                    submitKycButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Enviar para Verificación';
                    submitKycButton.disabled = false;
                }
            }
        }

        function handleKYCSubmit(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (!appState.currentUser) {
                showNotification('Debes iniciar sesión para enviar KYC', 'error');
                return;
            }
            
            const fullName = kycFullName ? kycFullName.value.trim() : '';
            const birthdate = document.getElementById('kyc-birthdate') ? document.getElementById('kyc-birthdate').value : '';
            const idType = document.getElementById('kyc-id-type') ? document.getElementById('kyc-id-type').value : '';
            const idNumber = document.getElementById('kyc-id-number') ? document.getElementById('kyc-id-number').value.trim() : '';
            const idCountry = document.getElementById('kyc-id-country') ? document.getElementById('kyc-id-country').value : '';
            const address = document.getElementById('kyc-address') ? document.getElementById('kyc-address').value.trim() : '';
            
            if (!fullName || !birthdate || !idType || !idNumber || !idCountry || !address) {
                showNotification('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            if (!kycFiles.id_front || !kycFiles.id_back || !kycFiles.selfie) {
                showNotification('Debes subir todos los documentos requeridos (frente, reverso y selfie)', 'error');
                return;
            }
            
            showNotification('Enviando verificación KYC...', 'warning');
            
            if (submitKycButton) {
                submitKycButton.disabled = true;
                submitKycButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Enviando...';
            }
            
            const kycData = {
                fullName: fullName,
                birthdate: birthdate,
                idType: idType,
                idNumber: idNumber,
                idCountry: idCountry,
                address: address,
                status: 'pending',
                submittedAt: Date.now(),
                updatedAt: Date.now()
            };
            
            db.ref('users/' + appState.currentUser.uid).update({
                kycData: kycData,
                kycStatus: 'pending',
                updatedAt: Date.now()
            })
            .then(() => {
                showNotification('¡Verificación KYC enviada correctamente! Será revisada por nuestro equipo en 24-48 horas.', 'success');
                
                if (kycForm) {
                    kycForm.reset();
                }
                Object.keys(kycFiles).forEach(docType => {
                    kycFiles[docType] = null;
                    const previewContainer = document.querySelector(`.kyc-file-preview[data-doc-type="${docType}"]`);
                    if (previewContainer) {
                        previewContainer.classList.add('hidden');
                        previewContainer.innerHTML = '';
                    }
                });
                
                updateKYCStatus();
            })
            .catch(error => {
                console.error('Error submitting KYC:', error);
                showNotification('Error al enviar la verificación KYC: ' + error.message, 'error');
            })
            .finally(() => {
                if (submitKycButton) {
                    submitKycButton.disabled = false;
                    submitKycButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Enviar para Verificación';
                }
            });
        }

        function updateWithdrawalDetails() {
            const selectedMethod = document.querySelector('input[name="withdrawal-method"]:checked');
            
            if (!selectedMethod) return;
            
            const methodValue = selectedMethod.value;
            
            document.querySelectorAll('.method-details').forEach(detail => {
                detail.classList.add('hidden');
            });
            
            document.querySelectorAll('.payment-method.withdrawal-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            const selectedElement = selectedMethod.closest('.payment-method');
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            const detailsElement = document.getElementById(`${methodValue}-details`);
            if (detailsElement) {
                detailsElement.classList.remove('hidden');
            }
        }

        function generateId() {
            return 'id_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        }

        function generateReferralCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            
            const day = date.getDate();
            const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const month = monthNames[date.getMonth()];
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${day} ${month} ${year}, ${hours}:${minutes}`;
        }

        function showNotification(message, type = 'info') {
            const notificationsContainer = document.getElementById('notifications-container');
            const notificationId = 'notification-' + Date.now();
            
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            notificationsContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        document.addEventListener('click', (e) => {
            if (e.target.closest('.notification')) {
                const notification = e.target.closest('.notification');
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.payment-method.withdrawal-method').forEach(method => {
                method.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        updateWithdrawalDetails();
                    }
                });
            });
            
            const bankRadio = document.getElementById('withdrawal-bank');
            if (bankRadio) {
                bankRadio.checked = true;
                setTimeout(updateWithdrawalDetails, 100);
            }
            
            console.log('Verificando elementos KYC...');
            
            const kycElements = {
                'kycForm': document.getElementById('kyc-form'),
                'kycFullName': document.getElementById('kyc-full-name'),
                'refreshKycStatus': document.getElementById('refresh-kyc-status'),
                'submitKycButton': document.getElementById('submit-kyc')
            };
            
            for (const [name, element] of Object.entries(kycElements)) {
                if (element) {
                    console.log(`✓ Elemento KYC "${name}": OK`);
                } else {
                    console.warn(`⚠ Elemento KYC "${name}": NO ENCONTRADO`);
                }
            }
        });

        function setupChartPeriodButtons() {
            document.querySelectorAll('.chart-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.chart-period-btn').forEach(b => {
                        b.classList.remove('bg-blue-100', 'text-blue-600', 'font-medium');
                        b.classList.add('bg-gray-100', 'text-gray-700');
                    });
                    this.classList.remove('bg-gray-100', 'text-gray-700');
                    this.classList.add('bg-blue-100', 'text-blue-600', 'font-medium');
                    
                    initPerformanceChart();
                });
            });
        }
    </script>
</body>
</html>
